(this["webpackJsonpecharts.index"]=this["webpackJsonpecharts.index"]||[]).push([[0],{270:function(t){t.exports=JSON.parse('{"a":"0.4.11"}')},466:function(t,e,s){},472:function(t,e){},474:function(t,e){},485:function(t,e){},487:function(t,e){},514:function(t,e){},516:function(t,e){},517:function(t,e){},522:function(t,e){},524:function(t,e){},543:function(t,e){},555:function(t,e){},558:function(t,e){},965:function(t){t.exports=JSON.parse('{"Save as image":"Save as image","Reset pan and zoom":"Reset pan and zoom","Save chart as svg":"Save chart as SVG","Unfortunately your browser does not support this feature":"Unfortunately your browser does not support this feature","Save chart as png":"Save chart as png","No data found":"No data found"}')},966:function(t){t.exports=JSON.parse('{"Save as image":"Als Bild speichern","Reset pan and zoom":"Verschiebung und Zoomen zur\xfccksetzen","Save chart as svg":"Diagramm als SVG speichern","Unfortunately your browser does not support this feature":"Leider unterst\xfctzt Ihr Browser diese Funktion nicht","Save chart as png":"Diagramm als PNG speichern","No data found":"Keine Daten gefunden"}')},967:function(t){t.exports=JSON.parse('{"Save as image":"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435","Reset pan and zoom":"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0441\u0434\u0432\u0438\u0433 \u0438 \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435","Save chart as svg":"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a \u043a\u0430\u043a SVG","Unfortunately your browser does not support this feature":"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0432\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u044d\u0442\u0443 \u0444\u0443\u043d\u043a\u0446\u0438\u044e","Save chart as png":"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u0443 \u043a\u0430\u043a png","No data found":"\u0414\u0430\u043d\u043d\u044b\u0435 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"}')},968:function(t){t.exports=JSON.parse('{"Save as image":"Salvar como imagem","Reset pan and zoom":"Redefinir panor\xe2mica e zoom","Save chart as svg":"Salvar gr\xe1fico como SVG","Unfortunately your browser does not support this feature":"Infelizmente, seu navegador n\xe3o oferece suporte a esse recurso","Save chart as png":"Salvar gr\xe1fico como png","No data found":"Nenhum dado encontrado"}')},969:function(t){t.exports=JSON.parse('{"Save as image":"Bewaar als afbeelding","Reset pan and zoom":"Stel pannen en zoomen opnieuw in","Save chart as svg":"Bewaar grafiek als SVG","Unfortunately your browser does not support this feature":"Helaas ondersteunt uw browser deze functie niet","Save chart as png":"Bewaar grafiek als png","No data found":"Geen data gevonden"}')},970:function(t){t.exports=JSON.parse('{"Save as image":"Enregistrer comme image","Reset pan and zoom":"R\xe9initialiser le panoramique et le zoom","Save chart as svg":"Enregistrer le graphique au format SVG","Unfortunately your browser does not support this feature":"Malheureusement, votre navigateur ne prend pas en charge cette fonctionnalit\xe9","Save chart as png":"Enregistrer le graphique au format png","No data found":"Aucune donn\xe9e disponible"}')},971:function(t){t.exports=JSON.parse('{"Save as image":"Salva come immagine","Reset pan and zoom":"Reimposta panoramica e zoom","Save chart as svg":"Salva grafico come SVG","Unfortunately your browser does not support this feature":"Purtroppo il tuo browser non supporta questa funzionalit\xe0","Save chart as png":"Salva grafico come png","No data found":"Nessun dato trovato"}')},972:function(t){t.exports=JSON.parse('{"Save as image":"Guardar como imagen","Reset pan and zoom":"Restablecer panor\xe1mica y zoom","Save chart as svg":"Guardar gr\xe1fico como SVG","Unfortunately your browser does not support this feature":"Lamentablemente, su navegador no es compatible con esta funci\xf3n.","Save chart as png":"Guardar gr\xe1fico como png","No data found":"Datos no encontrados"}')},973:function(t){t.exports=JSON.parse('{"Save as image":"Zapisz jako obraz","Reset pan and zoom":"Zresetuj przesuwanie i powi\u0119kszanie","Save chart as svg":"Zapisz wykres jako SVG","Unfortunately your browser does not support this feature":"Niestety Twoja przegl\u0105darka nie obs\u0142uguje tej funkcji","Save chart as png":"Zapisz wykres jako png","No data found":"Nie znaleziono danych"}')},974:function(t){t.exports=JSON.parse('{"Save as image":"\u53e6\u5b58\u4e3a\u56fe\u7247","Reset pan and zoom":"\u91cd\u7f6e\u5e73\u79fb\u548c\u7f29\u653e","Save chart as svg":"\u5c06\u56fe\u8868\u53e6\u5b58\u4e3aSVG","Unfortunately your browser does not support this feature":"\u4e0d\u5e78\u7684\u662f\uff0c\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u6b64\u529f\u80fd","Save chart as png":"\u5c06\u56fe\u8868\u53e6\u5b58\u4e3apng","No data found":"\u6ca1\u6709\u627e\u5230\u6570\u636e"}')},977:function(t,e,s){"use strict";s.r(e);var i=s(1),o=s.n(i),a=s(35),n=s.n(a),r=s(1002),h=s(1008),c=s(1007),l=(s(466),s(17)),d=s(329),u=s(1009),g=s(446),f=s.n(g),p=s(1004),m=s(124),v=s.n(m),b=s(447),y=s.n(b),x=s(38),w=s.n(x),S=s(127),D=s.n(S),C=s(448),I=s.n(C),T=s(200),M=s.n(T);s(587);function R(t){t=(t||"").toString().replace(/^\?/,"");const e={};return t.split("&").forEach((t=>{if(t=t.trim()){const s=t.split("="),i=decodeURIComponent(s[0]).trim();if(s.length>1)if(e[i]=decodeURIComponent(s[1]),"true"===e[i])e[i]=!0;else if("false"===e[i])e[i]=!1;else{const t=parseFloat(e[i]);t.toString()===e[i]&&(e[i]=t)}else e[i]=!0}})),e}function O(t){if(t.lines&&(t.l=t.lines,delete t.lines),t._ids){const e=t._ids?t._ids.split(";"):[],s=t._colors?t._colors.split(";"):[],i=t._names?t._names.split(";"):[],o=t._units?t._units.split(";"):[];t.l=[];for(let a=0;a<e.length;a++)t.l.push({id:e[a],offset:0,name:i[a]||"",aggregate:"onchange",color:s[a]||"blue",thickness:t.strokeWidth||1,shadowsize:t.strokeWidth||1,min:t.min||"",max:t.max||"",unit:o[a]||""});t.aggregateType="step",t.aggregateSpan=300,t.relativeEnd="now"}if(t.l)for(let e=0;e<t.l.length;e++)t.l[e].art&&(t.l[e].aggregate=t.l[e].art,delete t.l[e].art),t.instance&&!t.l[e].instance&&(t.l[e].instance=t.instance),t.l[e].yOffset=parseFloat(t.l[e].yOffset)||0,t.l[e].offset=parseFloat(t.l[e].offset)||0,t.l[e].validTime=parseFloat(t.l[e].validTime)||0;if(t.l=t.l||[],t.m){t.marks=[];for(let e=0;e<t.m.length;e++)t.marks[e]={lineId:t.m[e].l,upperValueOrId:t.m[e].v,lowerValueOrId:t.m[e].vl,color:t.m[e].c,fill:t.m[e].f,ol:t.m[e].t,os:t.m[e].s,text:t.m[e].d,textPosition:t.m[e].p,textOffset:t.m[e].py,textColor:t.m[e].fc,textSize:t.m[e].fs};delete t.m}return t.marks=t.marks||[],t.l.length||t.l.push({id:"",unit:""}),t.width=t.width||"100%",t.height=t.height||"100%",t.timeFormat=t.timeFormat||"",t.useComma="true"===t.useComma||!0===t.useComma,t.zoom="true"===t.zoom||!0===t.zoom,t.export="true"===t.export||!0===t.export,t.grid_hideX="true"===t.grid_hideX||!0===t.grid_hideX,t.grid_hideY="true"===t.grid_hideY||!0===t.grid_hideY,t.hoverDetail="true"===t.hoverDetail||!0===t.hoverDetail,t.noLoader="true"===t.noLoader||!0===t.noLoader,t.noedit="true"===t.noedit||!0===t.noedit,t.animation=parseInt(t.animation)||0,t.afterComma=void 0===t.afterComma?2:parseInt(t.afterComma,10),t.timeType=t.timeType||"relative",t}const k="notConnectedError";var E=class{constructor(t,e,s){s=Object.assign({updateTimeout:300},s||{}),this.socket=t,this.updateTimeout=s.updateTimeout||300,this.serverSide=s.serverSide||!1,this.seriesData=[],this.actualValues=[],this.ticks=null,this.liveInterval=null,this.reading=!1,this.navOptions={},this.subscribes=[],this.sessionId=1,this.updateInterval=null,this.presetSubscribed=!1,this.defaultHistory="",this.onUpdateFunc=null,this.onReadingFunc=null,this.onErrorFunc=null,this.objectPromises={},this.debug=!1,this.zoomData=null,this.serverSide||(this.lastHash=window.location.hash,e||(this.onHashInstalled=!0,this.onHashChangeBound=this.onHashChange.bind(this),window.addEventListener("hashchange",this.onHashChangeBound,!1)),this.onPresetUpdateBound=this.onPresetUpdate.bind(this)),this.onStateChangeBound=this.onStateChange.bind(this),this.socket.getSystemConfig().catch((t=>(t===k&&this.onErrorFunc&&this.onErrorFunc(t),console.error("Cannot read systemConfig: "+t),null))).then((t=>(this.systemConfig=t&&t.common?t.common:{},this.defaultHistory=this.systemConfig.defaultHistory,this.analyseAndLoadConfig(e))))}analyseAndLoadConfig(t){if(t)"string"===typeof t?this.preset=t:this.config=O(t);else{const t=R(window.location.search);if(this.debug=!0===t.debug||"true"===t.debug||1===t.debug||"1"===t.debug,t.preset&&"string"===typeof t.preset)this.preset=t.preset;else{const s=R((window.location.hash||"").toString().replace(/^#/,""));if(s.data)try{s.data=JSON.parse(s.data)}catch(e){s.data={}}if(t.data)try{t.data=JSON.parse(t.data)}catch(e){t.data={}}if(s.preset)this.preset=s.preset,(s.range||s.relativeEnd)&&(this.hash={range:s.range,relativeEnd:s.relativeEnd});else{const e=Object.assign(t.data||{},s.data||{},!0);void 0!==s.noLoader&&(e.noLoader=!0===s.noLoader||"true"===s.noLoader||1===s.noLoader||"1"===s.noLoader),void 0!==t.noLoader&&(e.noLoader=!0===t.noLoader||"true"===t.noLoader||1===t.noLoader||"1"===t.noLoader),this.config=O(e)}}}this.seriesData=[],this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null),this.preset?((this.preset.startsWith("echarts.")||this.preset.startsWith("flot."))&&this.preset.includes(".")||(this.preset="echarts.0."+this.preset),this.socket.getObject(this.preset).then((t=>{if(!t||!t.native||!t.native.data||"chart"!==t.type)return console.error("[ChartModel] Invalid object ".concat(this.preset,": ").concat(JSON.stringify(t)));this.config=O(t.native.data),this.config.useComma=void 0===this.config.useComma?!0===this.systemConfig.isFloatComma||"true"===this.systemConfig.isFloatComma:"true"===this.config.useComma||!0===this.config.useComma,this.config.lang=this.systemConfig.language,this.config.live=parseInt(this.config.live,10)||0,this.config.debug=this.debug,this.hash&&this.hash.range&&(this.config.range=this.hash.range),this.hash&&this.hash.relativeEnd&&(this.config.relativeEnd=this.hash.relativeEnd),this.readData(),this.serverSide||this.presetSubscribed===this.preset||(this.presetSubscribed&&this.socket.unsubscribeObject(this.presetSubscribed,this.onPresetUpdateBound),this.presetSubscribed=this.preset,this.socket.subscribeObject(this.preset,this.onPresetUpdateBound)),this.serverSide||!this.config.live||this.zoomData&&this.zoomData.stopLive||(this.updateInterval=setInterval((()=>this.readData()),1e3*this.config.live))})).catch((t=>{t===k&&this.onErrorFunc&&this.onErrorFunc(t),console.error("Cannot read ".concat(this.preset,": ").concat(t))}))):(this.config.useComma=void 0===this.config.useComma?!0===this.systemConfig.isFloatComma||"true"===this.systemConfig.isFloatComma:"true"===this.config.useComma||!0===this.config.useComma,this.config.lang=this.systemConfig.language,this.config.live=parseInt(this.config.live,10)||0,this.config.debug=this.debug,this.readData(),this.serverSide||!this.config.live||this.zoomData&&this.zoomData.stopLive||(this.updateInterval=setInterval((()=>this.readData()),1e3*this.config.live)))}onHashChange(){this.lastHash!==window.location.hash&&(this.lastHash=window.location.hash,this.analyseAndLoadConfig())}onPresetUpdate(t,e){t===this.preset&&(this.presetUpdateTimeout&&clearTimeout(this.presetUpdateTimeout),this.presetUpdateTimeout=setTimeout((()=>{let t;this.presetUpdateTimeout=null,t=O(e?e.native.data:{}),JSON.stringify(t)!==JSON.stringify(this.config)&&(this.config=t,this.updateInterval&&clearInterval(this.updateInterval),this.updateInterval=null,!this.config.live||this.zoomData&&this.zoomData.stopLive||(this.updateInterval=setInterval((()=>this.readData()),1e3*this.config.live)),this.readData())}),100))}setNewRange(t){if(this.debug&&console.log("[ChartModel] [".concat((new Date).toISOString(),"] setNewRange: ").concat(JSON.stringify(t))),t)if(t.stopLive)this.zoomData=this.zoomData||{},this.zoomData.stopLive=!0,this.updateInterval&&(console.log("Clear interval"),clearInterval(this.updateInterval),this.updateInterval=null);else{const e=this.zoomData&&this.zoomData.stopLive;e&&delete this.zoomData.stopLive,this.zoomData&&JSON.stringify(this.zoomData)===JSON.stringify(t)?e&&(this.zoomData.stopLive=!0):(this.zoomData=t,e&&(this.zoomData.stopLive=!0),this.readOnZoomTimeout&&clearTimeout(this.readOnZoomTimeout),this.readOnZoomTimeout=setTimeout((()=>{this.readOnZoomTimeout=null,this.readData()}),this.updateTimeout))}else this.zoomData&&(this.zoomData=null,this.readOnZoomTimeout&&clearTimeout(this.readOnZoomTimeout),this.readOnZoomTimeout=setTimeout((()=>{this.readOnZoomTimeout=null,!this.config.live||this.zoomData&&this.zoomData.stopLive||(console.log("Restore update"),this.updateInterval&&clearInterval(this.updateInterval),this.updateInterval=setInterval((()=>this.readData()),1e3*this.config.live)),this.readData()}),this.updateTimeout))}destroy(){this.subscribed&&(this.subscribes.forEach((t=>this.socket.unsubscribeState(t,this.onStateChangeBound))),this.subscribes=[],this.subscribed=null),this.readOnZoomTimeout&&(clearTimeout(this.readOnZoomTimeout),this.readOnZoomTimeout=null),this.presetUpdateTimeout&&(clearTimeout(this.presetUpdateTimeout),this.presetUpdateTimeout=null),this.presetSubscribed&&(this.socket.unsubscribeObject(this.presetSubscribed,this.onPresetUpdateBound),this.presetSubscribed=null),this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null),this.serverSide||(this.onHashInstalled&&window.removeEventListener("hashchange",this.onHashChangeBound,!1),this.onHashInstalled=!1)}onUpdate(t){this.onUpdateFunc=t}onReading(t){this.onReadingFunc=t}onError(t){this.onErrorFunc=t}getConfig(){return this.config}getSystemConfig(){return this.systemConfig}setConfig(t){this.analyseAndLoadConfig(t)}getStartStop(t,e){let s,i,o,a={};this.config.l[t].offset=this.config.l[t].offset||0;if("string"===typeof this.config.range&&this.config.range.includes("m")&&this.config.l.length>1){const t=parseInt(this.config.range,10)||1;for(let e=0;e<this.config.l.length;e++)if(this.config.l[e].offset&&0!==this.config.l[e].offset){o=this.addTime(this.now,this.config.l[0].offset);const e=new Date(o);e.setMonth(e.getMonth()-t),this.config.range=Math.floor((o-e.getTime())/6e4)+"";break}}if(e)return this.zoomData?(i=this.zoomData.start,s=this.zoomData.end):(s=this.addTime(this.now,this.config.l[t].offset),i=s-e),a={start:i,end:s,ignoreNull:void 0===this.config.l[t].ignoreNull?this.config.ignoreNull:this.config.l[t].ignoreNull,aggregate:this.config.l[t].aggregate||this.config.aggregate||"minmax",count:1,from:!1,ack:!1,q:!1,addID:!1},this.config.start=this.addTime(s,this.config.range,!1,!0),this.config.end=s,a;if(this.zoomData)i=this.zoomData.start,s=this.zoomData.end;else if("static"===this.config.timeType){let e,o;e=void 0!==this.config.start_time?this.config.start_time.split(":").map(Number):[0,0],o=void 0!==this.config.end_time?this.config.end_time.split(":").map(Number):[24,0],i=new Date(this.config.start).setHours(e[0],e[1]),s=new Date(this.config.end).setHours(o[0],o[1]),i=this.addTime(i,this.config.l[t].offset),s=this.addTime(s,this.config.l[t].offset)}else{if(this.config.relativeEnd=this.config.relativeEnd||"now","now"===this.config.relativeEnd)o=new Date(this.now);else if(-1!==this.config.relativeEnd.indexOf("minute")){const t=parseInt(this.config.relativeEnd,10)||1;o=new Date(this.now),o.setMinutes(Math.floor(o.getMinutes()/t)*t+t),o.setSeconds(0),o.setMilliseconds(0)}else if(-1!==this.config.relativeEnd.indexOf("hour")){const t=parseInt(this.config.relativeEnd,10)||1;o=new Date(this.now),o.setHours(Math.floor(o.getHours()/t)*t+t),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)}else"today"===this.config.relativeEnd?(o=new Date(this.now),o.setDate(o.getDate()+1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)):"weekUsa"===this.config.relativeEnd?(o=new Date(this.now),o.setDate(o.getDate()-o.getDay()+7),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)):"weekEurope"===this.config.relativeEnd?(o=new Date(this.now),0===o.getDay()?o.setDate(o.getDate()+1):o.setDate(o.getDate()-o.getDay()+8),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)):"month"===this.config.relativeEnd?(o=new Date(this.now),o.setMonth(o.getMonth()+1),o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)):"year"===this.config.relativeEnd&&(o=new Date(this.now),o.setFullYear(o.getFullYear()+1),o.setMonth(0),o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0));this.config.range=this.config.range||"30m",s=this.addTime(o,this.config.l[t].offset),i=this.addTime(s,this.config.range,!1,!0)}return a={start:i,end:s,ignoreNull:void 0===this.config.l[t].ignoreNull?this.config.ignoreNull:this.config.l[t].ignoreNull,aggregate:this.config.l[t].aggregate||this.config.aggregate||"minmax",from:!1,ack:!1,q:!1,addID:!1},"step"===this.config.aggregateType?a.step=1e3*this.config.aggregateSpan:"count"===this.config.aggregateType&&(a.count=this.config.aggregateSpan||300),this.config.start=i,this.config.end=s,a}readOneChart(t,e,s,i){const o=this.getStartStop(s);o.instance=e,o.sessionId=this.sessionId,this.debug&&console.log("[ChartModel] "+new Date(o.start)+" - "+new Date(o.end)),this.socket.getHistoryEx(t,o).then((t=>{if(this.sessionId&&t.sessionId&&t.sessionId!==this.sessionId)return console.warn("[ChartModel] Ignore request with sessionId=".concat(t.sessionId,", actual is ").concat(this.sessionId));if(t&&t.values){o.yOffset=this.config.l[s].yOffset;const e=t.values;this.seriesData[s]=[];const i=this.seriesData[s];for(let t=0;t<e.length;t++)"true"===e[t].val||!0===e[t].val?e[t].val=1:"false"!==e[t].val&&!1!==e[t].val||(e[t].val=0),"string"===typeof e[t].val&&(e[t].val=parseFloat(e[t].val)),i.push({value:[e[t].ts,null!==e[t].val?e[t].val+o.yOffset:null]});if(i.length){i[0].value[0]>o.start&&i.unshift({value:[o.start,null],exact:!1});const t=i[i.length-1];t.value[0]<o.end&&(this.config.l[s].validTime&&o.end-1e3*this.config.l[s].validTime<=t.value[0]?i.push({value:[o.end,t.value[1]],exact:!1}):i.push({value:[o.end,null],exact:!1}))}else i.push({value:[o.start,null],exact:!1}),i.push({value:[o.end,null],exact:!1});t.values=null,t=null}return Promise.resolve()})).catch((t=>{t===k&&this.onErrorFunc&&this.onErrorFunc(t),t&&console.error("[ChartModel] "+t)})).then((()=>this.config.legActual?this.socket.getState(t).then((t=>this.actualValues[s]=t&&t.val&&null!==t.val&&void 0!==t.val?t.val:null)).catch((e=>{console.warn("Cannot read last value of ".concat(t,": ").concat(e)),this.actualValues[s]=null})).then((()=>{this.subscribes.includes(t)||(this.subscribes.push(t),this.subscribed=!0,this.socket.subscribeState(t,this.onStateChangeBound))})):Promise.resolve())).then((()=>i(t,s)))}_readObject(t){return this.objectPromises[t]||(this.objectPromises[t]=this.socket.getObject(t).catch((e=>(e===k&&this.onErrorFunc&&this.onErrorFunc(e),console.error("Cannot read ".concat(t,": ").concat(e)),null)))),this.objectPromises[t]}_readOneLine(t,e){return this._readObject(this.config.l[t].id).then((e=>(e&&e.common&&(this.config.l[t].name=this.config.l[t].name||e.common.name,this.config.l[t].unit=this.config.l[t].unit||(e.common.unit?e.common.unit.replace("\ufffd","\xb0"):""),this.config.l[t].type=e.common.type,"auto"===this.config.l[t].chartType&&(this.config.l[t].chartType="boolean"===e.common.type?"steps":"line",this.config.l[t].aggregate="boolean"===e.common.type?"onchange":"minmax")),Promise.resolve()))).catch((e=>(e===k&&this.onErrorFunc&&this.onErrorFunc(e),console.error("[ChartModel] Cannot read object ".concat(this.config.l[t].id,": ").concat(e)),Promise.resolve()))).then((()=>{this.config.l[t].name=this.config.l[t].name||this.config.l[t].id,this.config.l[t].unit=this.config.l[t].unit||"","auto"===this.config.l[t].chartType&&(this.config.l[t].chartType="line",this.config.l[t].aggregate="minmax"),"object"===typeof this.config.l[t].name&&(this.config.l[t].name=this.config.l[t].name[this.systemConfig.language]||this.config.l[t].name.en),this.readOneChart(this.config.l[t].id,this.config.l[t].instance||this.defaultHistory,t,e)}))}_readData(t,e){if((e=e||0)>=this.config.l.length)return t();""!==this.config.l[e]&&void 0!==this.config.l[e]&&this.seriesData.push([]),this._readOneLine(e,(()=>setTimeout((()=>this._readData(t,e+1)),10)))}readTicks(t){if(this.config.ticks){const e=0,s=JSON.parse(JSON.stringify(this.getStartStop(e)));s.instance=this.config.l[e].instance||this.defaultHistory,s.sessionId=this.sessionId,s.aggregate="onchange",this.debug&&console.log("[ChartModel] Ticks: "+new Date(s.start)+" - "+new Date(s.end)),this.socket.getHistoryEx(this.config.ticks,s).then((t=>{if(this.sessionId&&t.sessionId&&t.sessionId!==this.sessionId)return console.warn("[ChartModel] Ignore request with sessionId=".concat(t.sessionId,", actual is ").concat(this.sessionId));if(t&&t.values){const e=this.ticks||[];this.ticks&&this.ticks.length&&this.ticks.splice(0,this.ticks.length);const i=t.values;for(let t=0;t<i.length;t++)null!==i[t].val&&e.push({value:[i[t].ts,i[t].val]});e.length?(e[0][0]>s.start&&e.unshift({value:[s.start,""]}),e[e.length-1][0]<s.end&&e.push({value:[s.end,""]})):(e.push({value:[s.start,""]}),e.push({value:[s.end,""]})),t.values=null,t=null,this.ticks=e}return Promise.resolve()})).catch((t=>{t===k&&this.onErrorFunc&&this.onErrorFunc(t),console.error("[ChartModel] ".concat(t))})).then((()=>t&&t(this.ticks)))}else t(null)}readValue(t,e,s){this.socket.getState(t).then((t=>{s(e,t&&parseFloat(t.val)||0)})).catch((t=>{t===k&&this.onErrorFunc&&this.onErrorFunc(t),console.error("[ChartModel] ".concat(t)),s(e,0)}))}readMarkings(t,e){return e=e||0,!this.config.marks||!this.config.marks.length||e>=this.config.marks.length?t():new Promise((t=>{(this.config.marks[e].upperValueOrId||0===this.config.marks[e].upperValueOrId)&&parseFloat(this.config.marks[e].upperValueOrId).toString()!==this.config.marks[e].upperValueOrId.toString().replace(/\.0*$/,"")&&this.config.marks[e].upperValueOrId.toString().includes(".")?this.socket.getState(this.config.marks[e].upperValueOrId).then((s=>{s&&void 0!==s.val&&null!==s.val?this.config.marks[e].upperValue=parseFloat(s.val)||0:this.config.marks[e].upperValue=null,t()})).catch((s=>{s===k&&this.onErrorFunc&&this.onErrorFunc(s),console.error("Cannot read marking ".concat(this.config.marks[e].upperValueOrId,": ").concat(s)),t()})):t()})).then((()=>new Promise((t=>{(this.config.marks[e].lowerValueOrId||0===this.config.marks[e].lowerValueOrId)&&parseFloat(this.config.marks[e].lowerValueOrId).toString()!==this.config.marks[e].lowerValueOrId.replace(/\.0*$/,"")&&this.config.marks[e].lowerValueOrId.includes(".")?this.socket.getState(this.config.marks[e].lowerValueOrId).then((s=>{s&&void 0!==s.val&&null!==s.val?this.config.marks[e].lowerValue=parseFloat(s.val)||0:this.config.marks[e].lowerValue=null,t()})).catch((s=>{s===k&&this.onErrorFunc&&this.onErrorFunc(s),console.error("Cannot read marking ".concat(this.config.marks[e].lowerValueOrId,": ").concat(s)),t()})):t()})))).then((()=>setTimeout((()=>this.readMarkings(t,e+1)),0)))}subscribeAll(t,e,s){s=s||0,!t||!t.length||s>=t.length?e():(this.socket.subscribeState(t[s],this.onStateChangeBound),setTimeout((()=>this.subscribeAll(t,e,s+1)),0))}onStateChange(t,e){if(!t||!e||!this.actualValues||this.reading)return;this.debug&&console.log("State update "+t+" - "+e.val);let s=!1;for(let i=0;i<this.config.l.length;i++)if(this.config.l[i].id===t){this.actualValues[i]!==e.val&&(this.actualValues[i]=e.val,s=!0);break}s&&this.onUpdateFunc(null,this.actualValues)}addTime(t,e,s,i){return t=new Date(t),"string"===typeof e?"m"===e[1]?(e=parseInt(e,10),t.setMonth(s?t.getMonth()+e:t.getMonth()-e),t=t.getTime()):"y"===e[1]?(e=parseInt(e,10),t.setFullYear(s?t.getFullYear()+e:t.getFullYear()-e),t=t.getTime()):(t=t.getTime(),i?s?t+=6e4*(parseInt(e,10)||0):t-=6e4*(parseInt(e,10)||0):s?t+=1e3*(parseInt(e,10)||0):t-=1e3*(parseInt(e,10)||0)):(t=t.getTime(),i?s?t+=6e4*(parseInt(e,10)||0):t-=6e4*(parseInt(e,10)||0):s?t+=1e3*(parseInt(e,10)||0):t-=1e3*(parseInt(e,10)||0)),t}readData(){this.readOnZoomTimeout&&(clearTimeout(this.readOnZoomTimeout),this.readOnZoomTimeout=null),this.now=Date.now(),console.log("Read till "+new Date(this.now)),this.sessionId=this.sessionId||0,this.sessionId++,this.sessionId>16777215&&(this.sessionId=1),this.config.l?(this.reading=!0,this.onReadingFunc&&this.onReadingFunc(!0),this.seriesData=[],this._readData((()=>this.readTicks((t=>this.readMarkings((()=>{this.reading=!1,this.onUpdateFunc(this.seriesData,this.actualValues)}))))))):(this.onErrorFunc&&this.onErrorFunc("No config provided"),this.onReadingFunc&&this.onReadingFunc(!1),this.reading=!1)}},N=s(1005),F=s(202),z=s(44),L=s.n(z),_=(s(588),s(589),s(590),s(591),s(592),s(593),s(594),s(595),s(596),s(597),s(449)),A=s.n(_),j=s(4),B=s.n(j);s(367),s(375),s(376),s(380),s(381),s(382),s(182),s(370),s(383),s(681);const V={azul:["#f2385a","#f5a503","#4ad9d9","#f7879c","#c1d7a8","#4dffd2","#fccfd7","#d5f6f6"],"bee-inspired":["#001727","#805500","#ffff00","#ffd11a","#f2d71f","#f2be19","#f3a81a","#fff5cc"],blue:["#1790cf","#1bb2d8","#99d2dd","#88b0bb","#1c7099","#038cc4","#75abd0","#afd6dd"],infographic:["#C1232B","#27727B","#FCCE10","#E87C25","#B5C334","#FE8463","#9BCA63","#FAD860","#F3A43B","#60C0DD","#D7504B","#C6E579","#F4E001","#F0805A","#26C0C0"],vintage:["#d87c7c","#919e8b","#d7ab82","#6e7074","#61a0a8","#efa18d","#787464","#cc7e63","#724e58","#4b565b"],dark:["#dd6b66","#759aa0","#e69d87","#8dc1a9","#ea7e53","#eedd78","#73a373","#73b9bc","#7289ab","#91ca8c","#f49f42"],macarons:["#2ec7c9","#b6a2de","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],shine:["#c12e34","#e6b600","#0098d9","#2b821d","#005eaa","#339ca8","#cda819","#32a487"],roma:["#E01F54","#001852","#f5e8c8","#b8d2c7","#c6b38e","#a4d8c2","#f3d999","#d3758f","#dcc392","#2e4783","#82b6e9","#ff6347","#a092f1","#0a915d","#eaf889","#6699FF","#ff6666","#3cb371","#d5b158","#38b6b6"],royal:["#3f7ea6","#993366","#408000","#8c6f56","#a65149","#731f17","#adc2eb","#d9c3b0"],"dark-blue":["#00305a","#004b8d","#0074d9","#4192d9","#7abaf2","#99cce6","#d6ebf5","#eeeeee"],"tech-blue":["#4d4d4d","#3a5897","#007bb6","#7094db","#0080ff","#b3b3ff","#00bdec","#33ccff","#ccddff","#eeeeee"],red:["#d8361b","#f16b4c","#f7b4a9","#d26666","#99311c","#c42703","#d07e75"],"red-velvet":["#8b1a2d","#a7314b","#e6004c","#ff8066","#8e5c4e","#ff1a66","#d6c582","#f0d4af"],green:["#408829","#68a54a","#a9cba2","#86b379","#397b29","#8abb6f","#759c6a","#bfd3b7"],light:["#37A2DA","#32C5E9","#67E0E3","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#E062AE","#E690D1","#e7bcf3","#9d96f5","#8378EA","#96BFFF"],gray:["#757575","#c7c7c7","#dadada","#8b8b8b","#b5b5b5","#e9e9e9"],"dark-bold":["#458c6b","#f2da87","#d9a86c","#d94436","#a62424","#76bc9b","#cce6da","#eeeeee"]};function H(t){return(t=(t||"").toString()).length<2?"0"+t:t}function U(t,e){let s=!1;t.includes("rgb")&&(t=function(t){const e=t.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i);return e?"#"+H(parseInt(e[1],10).toString(16))+H(parseInt(e[2],10).toString(16))+H(parseInt(e[3],10).toString(16)):t}(t)),"#"===t[0]&&(t=t.slice(1),s=!0);const i=parseInt(t,16);let o=(i>>16)+e;o>255?o=255:o<0&&(o=0);let a=(i>>8&255)+e;a>255?a=255:a<0&&(a=0);let n=(255&i)+e;return n>255?n=255:n<0&&(n=0),(s?"#":"")+(n|a<<8|o<<16).toString(16)}const P=function(t){this.colorStops=t||[]};P.prototype={constructor:P,addColorStop:function(t,e){this.colorStops.push({offset:t,color:e})}};const J=function(t,e,s,i,o,a){this.x=null==t?0:t,this.y=null==e?0:e,this.x2=null==s?1:s,this.y2=null==i?0:i,this.type="linear",this.global=a||!1,P.call(this,o)};J.prototype={constructor:J},function(t,e){const s=t.prototype;function i(){}i.prototype=e.prototype,t.prototype=new i;for(const o in s)s.hasOwnProperty(o)&&(t.prototype[o]=s[o]);t.prototype.constructor=t,t.superClass=e}(J,P);var W=class{constructor(t,e,s,i){if(this.moment=t,!this.moment)throw new Error("moment must be set and initialized");this.config=i?JSON.parse(JSON.stringify(i)):null,this.calcTextWidth=s,this.themeType=e||"light",this.chart={yAxis:[]},this.isTouch="ontouchstart"in window.document.documentElement}setThemeName(t){this.themeType=t||"light"}setConfig(t){this.config=t}getHelperChartData(){return this.chart}convertData(t,e,s){const i=t[e];if(!i||!i.length)return[];const o=this.chart.yAxis[s]||{max:null,min:null};this.chart.yAxis[s]=o;for(let a=0;a<i.length;a++)null!==i[a].value[1]&&((null===o.min||o.min>i[a].value[1])&&(o.min=i[a].value[1]),(null===o.max||o.max<i[a].value[1])&&(o.max=i[a].value[1]));return(null===this.chart.xMin||this.chart.xMin>i[0].value[0])&&(this.chart.xMin=i[0].value[0]),(null===this.chart.xMax||this.chart.xMax<i[i.length-1].value[0])&&(this.chart.xMax=i[i.length-1].value[0]),i}getSeries(t,e){this.chart.xMin=null,this.chart.xMax=null;let s=0;return this.config.l.map(((i,o)=>{const a=i.color||(V[e]?V[e][s%V[e].length]:"");i.color||s++,i.shadowsize=parseFloat(i.shadowsize)||0,"false"===i.dashes?i.dashes=!1:"true"===i.dashes&&(i.dashes=!0);const n=""===i.commonYAxis||void 0===i.commonYAxis?o:parseInt(i.commonYAxis)||0,r={name:i.name,clip:!0,xAxisIndex:0,yAxisIndex:n,type:"scatterplot"===i.chartType?"scatter":"line",showSymbol:"scatterplot"===i.chartType||i.points,hoverAnimation:!0,animation:!1,step:"steps"===i.chartType?"end":"stepsStart"===i.chartType?"start":void 0,smooth:"spline"===i.chartType,data:this.convertData(t,o,n),itemStyle:{color:a},symbolSize:"scatterplot"===i.chartType||i.points?i.symbolSize||3:void 0,symbol:"circle",lineStyle:{width:parseFloat(i.thickness)||1,shadowBlur:i.shadowsize?i.shadowsize+1:0,shadowOffsetY:i.shadowsize?i.shadowsize+1:0,shadowColor:a,type:i.dashes?"dashed":i.lineStyle||"solid"}};if(parseFloat(i.fill)){let t;t=this.isTouch?a:new J(0,0,0,1,[{offset:0,color:U(a,30)},{offset:1,color:a}]),r.areaStyle={color:t,opacity:parseFloat(i.fill)||0}}return r}))}getXAxis(){return[{type:"time",splitLine:{show:!this.config.grid_hideX,lineStyle:"off"===this.config.l[0].xaxe?{color:"rgba(0,0,0,0)",type:"dashed"}:this.config.grid_color?{color:this.config.grid_color,type:"dashed"}:{type:"dashed"}},splitNumber:parseInt(this.config.l[0].xticks,10)||void 0,position:"top"===this.config.l[0].xaxe?"top":"bottom",min:this.chart.xMin,max:this.chart.xMax,axisTick:{alignWithLabel:!0,lineStyle:"off"===this.config.l[0].xaxe?{color:"rgba(0,0,0,0)"}:this.config.x_ticks_color?{color:this.config.x_ticks_color}:void 0},axisLabel:{formatter:this.xFormatter.bind(this),color:"off"===this.config.l[0].xaxe?"rgba(0,0,0,0)":this.config.x_labels_color||void 0}}]}getYAxis(t,e){return this.config.l.map(((t,s)=>{if(!t||""!==t.commonYAxis&&void 0!==t.commonYAxis)return{};let i=parseFloat(t.min),o=parseFloat(t.max);const a=this.chart.yAxis;if(a[s]){const t=a[s].max-a[s].min;isNaN(i)&&(i=a[s].min-.1*t,t>25e3?i=1e4*Math.floor(i/1e4):t>5e3?i=1e3*Math.floor(i/1e3):t>200?i=100*Math.floor(i/100):t>30?i=10*Math.floor(i/10):t>10?i=Math.floor(i):t>1&&(i=Math.floor(10*i)/10)),isNaN(o)&&(o=a[s].max+.1*t,t>25e3?o=1e4*Math.ceil(o/1e4):t>5e3?o=1e3*Math.ceil(o/1e3):t>200?o=100*Math.ceil(o/100):t>30?o=10*Math.ceil(o/10):t>10?o=Math.ceil(o):t>1&&(o=Math.floor(10*o)/10))}else isNaN(i)&&(i=void 0),isNaN(o)&&(o=void 0);let n="off"===t.yaxe?"rgba(0,0,0,0)":this.config.grid_color||void 0;return"leftColor"!==t.yaxe&&"rightColor"!==t.yaxe||(n=e[s].itemStyle.color),{type:"value",min:i,max:o,position:"left"===t.yaxe||"off"===t.yaxe||"leftColor"===t.yaxe?"left":"right"===t.yaxe||"rightColor"===t.yaxe||s?"right":"left",splitLine:s?void 0:{show:!this.config.grid_hideY,lineStyle:{color:n||void 0,type:"dashed"}},splitNumber:parseInt(t.yticks,10)||void 0,axisLabel:{formatter:t=>this.yFormatter(t,s,!0),color:"off"===t.yaxe||"leftColor"===t.yaxe||"rightColor"===t.yaxe?n:this.config.y_labels_color||void 0},axisTick:{alignWithLabel:!0,lineStyle:n?{color:n}:this.config.y_ticks_color?{color:this.config.y_ticks_color}:void 0}}}))}getMarkings(t){return this.config.marks&&this.config.marks.forEach((e=>{if(!e)return;const s=void 0!==e.lowerValue?e.lowerValue:parseFloat(e.lowerValueOrId),i=void 0!==e.upperValue?e.upperValue:parseFloat(e.upperValueOrId),o=null!==s&&!isNaN(s),a=null!==i&&!isNaN(i),n=t.series[e.lineId];if(n){if(o&&a&&(n.markArea=n.markArea||{symbol:["none","none"],itemStyle:{color:e.color||n.itemStyle.color,borderWidth:0,opacity:parseFloat(e.fill)||0},data:[]},n.markArea.data.push([{yAxis:s,name:e.text||""},{yAxis:i}])),o||a)for(let r=0;r<2;r++){if(!r&&!a)continue;if(r&&!o)continue;const h=r?s:i;if(n.markLine=n.markLine||{symbol:["none","none"],data:[]},n.markLine.data.push({yAxis:h,name:e.text,lineStyle:{color:e.color||n.itemStyle.color,width:parseFloat(e.ol)||1,shadowBlur:parseFloat(e.os)?parseFloat(e.os)+1:0,shadowOffsetY:parseFloat(e.os)?parseFloat(e.os)+1:0,shadowColor:e.color,type:e.lineStyle||"solid"},label:{show:!!e.text,formatter:t=>t.name,position:"r"===e.textPosition?"end":"start",distance:-1*e.textOffset||-35,textStyle:{color:e.textColor||"#FFF",fontStyle:"normal",fontSize:e.textSize||void 0}}}),this.config.l[e.lineId]){let s=parseFloat(this.config.l[e.lineId].min);isNaN(s)&&this.chart.yAxis[e.lineId]&&this.chart.yAxis[e.lineId].min>h&&h<0&&(t.yAxis[0].min=h);let i=parseFloat(this.config.l[e.lineId].min);isNaN(i)&&this.chart.yAxis[e.lineId]&&this.chart.yAxis[e.lineId].max<h&&(t.yAxis[0].max=h)}}}else console.error("Mark line has no chart line")})),t}yFormatter(t,e,s,i){if("boolean"===this.config.l[e].type)return t?"TRUE":"FALSE";if(null===t||void 0===t)return"";const o=this.config.l[e].afterComma;return void 0!==o&&null!==o?(t=parseFloat(t),this.config.useComma?t.toFixed(o).replace(".",",")+(s?this.config.l[e].unit:""):t.toFixed(o)+(s?this.config.l[e].unit:"")):(i&&(t=Math.round(1e4*t)/1e4),this.config.useComma?(t=parseFloat(t)||0).toString().replace(".",",")+(s?this.config.l[e].unit:""):t.toString()+(s?this.config.l[e].unit:""))}isXLabelHasBreak(){return this.config.timeFormat?this.config.timeFormat.replace("<br/>","\n").includes("\n"):!this.chart.withSeconds&&(this.chart.withTime,!0)}xFormatter(t,e){const s=new Date(t);return this.config.timeFormat?this.moment(s).format(this.config.timeFormat).replace("<br/>","\n"):this.chart.withSeconds?H(s.getHours())+":"+H(s.getMinutes())+":"+H(s.getSeconds()):this.chart.withTime?H(s.getHours())+":"+H(s.getMinutes())+"\n"+H(s.getDate())+"."+H(s.getMonth()+1):H(s.getDate())+"."+H(s.getMonth()+1)+"\n"+s.getFullYear()}getInterpolatedValue(t,e,s,i){const o=this.option.series[t].data;if(!o||!o[0]||o[0].value[0]>e||o[o.length-1].value[0]<e)return null;for(let a=0;a<o.length-1;a++){if(o[a].value[0]===e)return{exact:!0,val:o[a].value[1]};if(o[a].value[0]<e&&e<o[a+1].value[0]){const t=o[a].value[1],n=o[a+1].value[1];if(null===n||void 0===n||null===t||void 0===t)return i?null:{exact:!1,val:null};if("boolean"===s)return{exact:!1,val:t};const r=o[a+1].value[0]-o[a].value[0];return{exact:!1,val:(1-(o[a+1].value[0]-e)/r)*(n-t)+t}}}return i?null:{exact:!1,val:null}}renderTooltip(t){const e=t[0].value[0],s=new Date(e),i=!0===this.config.hoverNoNulls||"true"===this.config.hoverNoNulls,o=this.option.series.map(((s,o)=>{const a=t.find((t=>t.seriesIndex===o));let n;if(a&&(n={exact:void 0===a.data.exact||a.data.exact,val:a.value[1]}),n=n||this.getInterpolatedValue(o,e,this.config.l[o].type,i),!n)return"";if(!n.exact&&this.config.hoverNoInterpolate)return"";const r=null===n.val?"null":this.yFormatter(n.val,o,!1,!n.exact);return'<div style="width: 100%; display: inline-flex; justify-content: space-around; color: '.concat(s.itemStyle.color,'">')+'<div style="display: flex;margin-right: 4px">'.concat(s.name,":</div>")+'<div style="display: flex; flex-grow: 1"></div>'+'<div style="display: flex;">'.concat(n.exact?"":"i ","<b>").concat(r,"</b>").concat(null!==n.val?this.config.l[o].unit:"","</div>")+"</div>"})),a=this.config.timeFormat||"dd, MM Do YYYY, h:mm:ss.SSS";return"<b>".concat(this.moment(s).format(a),"</b><br/>").concat(o.filter((t=>t)).join("<br/>"))}getLegend(t,e){if(this.config.legend&&"none"!==this.config.legend){const s={data:this.config.l.map((t=>t.name)),show:!0,left:"nw"===this.config.legend||"sw"===this.config.legend?this.chart.padLeft+1:void 0,right:"ne"===this.config.legend||"se"===this.config.legend?this.chart.padRight+1:void 0,top:"nw"===this.config.legend||"ne"===this.config.legend?10:void 0,bottom:"sw"===this.config.legend||"se"===this.config.legend?t+20:void 0,backgroundColor:this.config.legBg||void 0,formatter:(t,s)=>{if(this.config.legActual&&e)for(let i=0;i<this.config.l.length;i++)if(this.config.l[i].name===t)return"".concat(t," [").concat(this.yFormatter(e[i],i,!0),"]");return t},textStyle:{color:this.config.legColor||("light"===this.themeType?"#000":"#FFF")},orient:this.config.legendDirection||"horizontal",selected:{}};return this.config.l.forEach((t=>s.selected[t.name]=!0!==t.hide)),s}}getTitle(t){if(!this.config||!this.config.title)return;let e={};return(this.config.titlePos||"top:35;left:65").split(";").forEach((t=>{const s=t.split(":");e[s[0].trim()]=parseInt(s[1].trim(),10)})),{text:this.config.title,textStyle:{fontSize:this.config.titleSize?parseInt(this.config.titleSize,10):20,color:this.config.titleColor||("light"===this.themeType?"#000":"#FFF")},textVerticalAlign:e.bottom?"bottom":"top",textAlign:50===e.left?"center":-5===e.right?"right":"left",top:35===e.top?5:50===e.top?"50%":void 0,left:50===e.left?"50%":65===e.left?this.chart.padLeft:void 0,bottom:e.bottom?e.bottom>0?e.bottom+t-10:e.bottom:void 0,right:5===e.right?this.chart.padRight:void 0}}getOption(t,e,s){e&&(this.config=JSON.parse(JSON.stringify(e)));const i=this.isTouch&&this.config.zoom;let o=this.config.theme;o&&"default"!==o||(o="light"===this.themeType?"roma":"dark-bold"),this.debug=this.config&&this.config.debug,this.debug&&console.log("[ChartView ] [".concat((new Date).toISOString(),"] ").concat(JSON.stringify(this.config,null,2)));const a=this.getSeries(t,o);this.config.start&&(this.chart.xMax<this.config.end&&(this.chart.xMax=this.config.end),this.chart.xMin>this.config.start&&(this.chart.xMin=this.config.start)),this.chart.diff=this.chart.xMax-this.chart.xMin,this.chart.withTime=this.chart.diff<6048e5,this.chart.withSeconds=this.chart.diff<18e5;const n=this.getYAxis(o,a),r=this.getXAxis(),h={theme:o,backgroundColor:"transparent",animation:!this.config.noAnimation&&!this.config.noLoader,grid:{backgroundColor:this.config.bg_custom||"transparent",show:!!this.config.bg_custom,left:0,top:8,right:0,bottom:this.isXLabelHasBreak()?40:24},tooltip:this.config.hoverDetail?{trigger:"axis",formatter:t=>this.renderTooltip(t),hoverAnimation:!0,axisPointer:{animation:!0}}:void 0,xAxis:r,yAxis:n,series:a,useCanvas:i};this.getMarkings(h);let c=0,l=0;return a.forEach(((t,e)=>{let s=h.yAxis[t.yAxisIndex];if(!s){const i=this.config.l[t.yAxisIndex]?this.config.l[t.yAxisIndex].commonYAxis:void 0;if(void 0===i)return void console.log("Cannot find Y axis for line "+e);s=h.yAxis[i]}let i=this.yFormatter(s.min,e,!0),o=this.yFormatter(s.min||s.max!==s.min?s.max:.8,e,!0);const a=s.position;if("off"===a||s.axisLabel&&"rgba(0,0,0,0)"===s.axisLabel.color)return;let n=this.calcTextWidth(i)+4,r=this.calcTextWidth(o)+4;"left"===a||"leftColor"===a?(n>c&&(c=n),r>c&&(c=r)):(n>l&&(l=n),r>l&&(l=r))})),h.grid.left=c+10,h.grid.right=l+10+(!0===this.config.export||"true"===this.config.export?20:0),this.chart.padLeft=h.grid.left,this.chart.padRight=h.grid.right,h.legend=this.getLegend(20,s),h.title=this.getTitle(20),this.config.grid_color||(h.yAxis.forEach((t=>t.splitLine&&delete t.splitLine.lineStyle)),h.xAxis.forEach((t=>t.splitLine&&delete t.splitLine.lineStyle))),this.option=h,this.option}},Y=(s(730),s(938),s(939),s(940),s(941),s(942),s(943),s(944),s(945),s(946),s(947),s(948),s(949),s(950),s(951),s(952),s(953),s(422),s(427),s(267),s(431),s(428),s(29));let X=null;function G(t,e,s){const i=(X||(X=document.createElement("canvas"))).getContext("2d");i.font="".concat(e||12,"px ").concat(s||"Microsoft YaHei");const o=i.measureText(t);return Math.ceil(o.width)}String.prototype.padStart||(String.prototype.padStart=function(t,e){return t>>=0,e=String("undefined"!==typeof e?e:" "),this.length>t?String(this):((t-=this.length)>e.length&&(e+=e.repeat(t/e.length)),e.slice(0,t)+String(this))});class Z extends o.a.Component{constructor(t){super(t),this.updateProperties=t=>{if(this.updatePropertiesTimeout=null,this.echartsReact&&"function"===typeof this.echartsReact.getEchartsInstance){const s=this.echartsReact.getEchartsInstance(),i=t.config&&t.config.l&&t.config.l.map((t=>t.id))||[];i.sort();const o=JSON.stringify(i)!==JSON.stringify(this.lastIds);o&&(this.lastIds=i,s.clear()),this.option=this.chartOption.getOption(t.data,t.config,t.actualValues),this.applySelected(),this.debug&&console.log("[ChartView ] [".concat((new Date).toISOString(),"] updateProperties: {min: ").concat(this.option.xAxis[0].min,", ").concat(this.option.xAxis[0].max,"}"));try{s.setOption(this.option,o)}catch(e){console.error("Cannot apply options: "+JSON.stringify(this.option))}}},this.onResize=()=>{this.timerResize&&clearTimeout(this.timerResize),this.timerResize=setTimeout((()=>{this.timerResize=null,this.componentDidUpdate()}))},this.onMouseMove=t=>{if(this.mouseDown){this.divResetButton.current&&"block"!==this.divResetButton.current.style.display&&(this.divResetButton.current.style.display="block");const e=this.chartOption.getHelperChartData(),s=e.lastX-(t.offsetX-e.padLeft);e.lastX=t.offsetX-e.padLeft;const i=e.xMax-e.xMin,o=this.state.chartWidth-e.padRight-e.padLeft,a=Math.round(s*i/o);e.xMin+=a,e.xMax+=a,this.setNewRange()}},this.onMouseDown=t=>{this.mouseDown=!0;this.chartOption.getHelperChartData().lastX=t.offsetX,this.zr&&!this.zr._mousemove&&(this.zr._mousemove=!0,this.zr.on("mousemove",this.onMouseMove));this.props.config.live&&this.props.onRangeChange&&(console.log("Stop update"),this.props.onRangeChange({stopLive:!0}))},this.onMouseUp=()=>{this.mouseDown=!1,this.setNewRange(!0),this.zr&&this.zr._mousemove&&(this.zr._mousemove=!1,this.zr.off("mousemove",this.onMouseMove))},this.onMouseWheel=t=>{const e=this.chartOption.getHelperChartData();let s=e.xMax-e.xMin;const i=this.state.chartWidth-e.padRight-e.padLeft,o=(t.offsetX-e.padLeft)/i,a=s;s*=t.wheelDelta>0?1.1:.9;const n=a-s;e.xMax+=n*(1-o),e.xMin-=n*o,this.setNewRange(),this.updateDataTimer&&clearTimeout(this.updateDataTimer),this.updateDataTimer=setTimeout((()=>this.setNewRange(!0)),1e3)},this.onTouchStart=t=>{this.mouseDown=!0;const e=t.touches||t.originalEvent.touches;if(e){t.preventDefault(),t.stopImmediatePropagation();const s=this.chartOption.getHelperChartData();s.lastX=e[e.length-1].pageX,e.length>1?s.lastWidth=Math.round(Math.abs(e[0].pageX-e[1].pageX)):s.lastWidth=null}},this.onTouchEnd=t=>{this.mouseDown&&(t.stopImmediatePropagation(),t.preventDefault(),this.mouseDown=!1,this.setNewRange(!0))},this.onTouchMove=t=>{const e=t.touches||t.originalEvent.touches;if(!e)return;const s=this.chartOption.getHelperChartData(),i=e[e.length-1].pageX-s.padLeft;if(this.mouseDown)if(t.preventDefault(),t.stopImmediatePropagation(),this.divResetButton.current&&"block"!==this.divResetButton.current.style.display&&(this.divResetButton.current.style.display="block"),e.length>1){console.log("touch move: "+e.length);const t=Math.round(Math.abs(e[0].pageX-e[1].pageX));if(null!==s.lastWidth&&t!==s.lastWidth){let i=s.xMax-s.xMin;const o=this.state.chartWidth-s.padRight-s.padLeft,a=t>s.lastWidth?1.05:.95,n=(e[0].pageX>e[1].pageX?e[1].pageX-s.padLeft+t/2:e[0].pageX-s.padLeft+t/2)/o,r=i;i*=a;const h=r-i;console.log("Move: ".concat(Math.round(h/1e3)," => ").concat(Math.round(h*n/1e3)," -- ").concat(Math.round(h*(1-n)/1e3))),s.xMax+=h*(1-n),s.xMin-=h*n,s.xMax=Math.round(s.xMax),s.xMin=Math.round(s.xMin),this.setNewRange()}s.lastWidth=t}else{const t=s.lastX-i,e=s.xMax-s.xMin,o=this.state.chartWidth-s.padRight-s.padLeft,a=Math.round(t*e/o);s.xMin+=a,s.xMax+=a,this.setNewRange()}s.lastX=i},this.state={chartHeight:null,chartWidth:null},this.echartsReact=o.a.createRef(),this.divRef=o.a.createRef(),this.divResetButton=o.a.createRef(),this.selected=null,L.a.locale(w.a.getLanguage()),this.lastIds=this.props.config&&this.props.config.l&&this.props.config.l.map((t=>t.id))||[],this.lastIds.sort(),this.chartOption=new W(L.a,this.props.themeType,G)}componentDidMount(){window.addEventListener("resize",this.onResize)}componentWillUnmount(){window.removeEventListener("resize",this.onResize)}UNSAFE_componentWillReceiveProps(t){if(t.data===this.state.data)return null;this.updatePropertiesTimeout&&clearTimeout(this.updatePropertiesTimeout),this.updatePropertiesTimeout=setTimeout(this.updateProperties,100,t)}setNewRange(t){const e=this.chartOption.getHelperChartData();if(e.diff=e.xMax-e.xMin,e.withTime=e.diff<6048e5,e.withSeconds=e.diff<18e5,console.log("[ChartView ] [".concat((new Date).toISOString(),"] setNewRange: ").concat(!!t,", {min: ").concat(new Date(e.xMin),", max: ").concat(new Date(e.xMax),"}")),t)this.updateDataTimer&&clearTimeout(this.updateDataTimer),this.updateDataTimer=null,this.props.onRangeChange&&this.props.onRangeChange({start:e.xMin,end:e.xMax});else{console.log("[ChartView ] [".concat((new Date).toISOString(),"] setOption in setNewRange")),this.option.xAxis[0].min=e.xMin,this.option.xAxis[0].max=e.xMax;try{this.echartsReact&&"function"===typeof this.echartsReact.getEchartsInstance&&this.echartsReact.getEchartsInstance().setOption({xAxis:{min:e.xMin,max:e.xMax}})}catch(s){console.error("Cannot apply options 1: "+JSON.stringify(this.option))}}}installEventHandlers(){this.zr=this.echartsReact&&this.echartsReact.getEchartsInstance&&this.echartsReact.getEchartsInstance().getZr();const t=this.divRef.current&&this.divRef.current.getElementsByClassName("echarts-for-react"),e=t&&t[0];this.zr&&this.props.config.zoom&&!this.zr._iobInstalled?(this.zr._iobInstalled=!0,this.option&&this.option.useCanvas?e&&(e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchmove",this.onTouchMove,!1)):(this.zr.on("mousedown",this.onMouseDown),this.zr.on("mouseup",this.onMouseUp),this.zr.on("mousewheel",this.onMouseWheel))):this.zr&&!this.props.config.zoom&&this.zr._iobInstalled&&(this.zr._iobInstalled=!1,this.option||!this.option.useCanvas?(this.zr.off("mousedown",this.onMouseDown),this.zr.off("mouseup",this.onMouseUp),this.zr.off("mousewheel",this.onMouseWheel),this.zr&&this.zr._mousemove&&(this.zr._mousemove=!1,this.zr.off("mousemove",this.onMouseMove))):e&&(e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchmove",this.onTouchMove,!1)))}applySelected(){this.selected&&this.option.legend&&Object.keys(this.selected).forEach((t=>this.option.legend.selected[t]=this.selected[t]))}renderChart(){return this.props.data?(this.option=this.option||this.chartOption.getOption(this.props.data,this.props.config,this.props.actualValues),this.debug&&console.log("[ChartView ] [".concat((new Date).toISOString(),"] render chart")),this.applySelected(),Object(Y.jsx)(A.a,{ref:t=>this.echartsReact=t,echarts:B.a,option:this.option,notMerge:!0,lazyUpdate:!0,theme:this.option.theme,style:{height:this.state.chartHeight+"px",width:"100%"},opts:this.option&&this.option.useCanvas?void 0:{renderer:"svg"},onEvents:{legendselectchanged:t=>{this.selected=JSON.parse(JSON.stringify(t.selected))},rendered:t=>{this.props.config.zoom&&this.installEventHandlers()}}})):Object(Y.jsx)(p.a,{})}componentDidUpdate(){if(this.divRef.current){const t="noborder"!==this.props.config.noBorder&&parseFloat(this.props.config.border_width)||0,e=parseFloat(this.props.config.border_padding)||0,s=this.divRef.current.offsetHeight-2*(t+e);if(this.state.chartHeight!==s){const i=this.divRef.current.offsetWidth-2*(t+e);setTimeout((()=>this.setState({chartHeight:s,chartWidth:i})),10)}}}renderResetButton(){return Object(Y.jsx)(N.a,{ref:this.divResetButton,size:"small",color:"default",style:{display:"none"},className:this.props.classes.resetButton,title:w.a.t("Reset pan and zoom"),onClick:()=>{this.divResetButton.current&&(this.divResetButton.current.style.display="none"),this.props.onRangeChange&&this.props.onRangeChange()},children:Object(Y.jsx)(F.b,{className:this.props.classes.resetButtonIcon})})}renderExportButton(){return this.props.config.export?Object(Y.jsx)(F.a,{color:this.props.config.exportColor||"default",className:this.props.classes.exportButton,title:this.option&&this.option.useCanvas?w.a.t("Save chart as png"):w.a.t("Save chart as svg"),onClick:()=>{if(this.echartsReact&&"function"===typeof this.echartsReact.getEchartsInstance){const e=this.echartsReact.getEchartsInstance().getDataURL({pixelRatio:2,backgroundColor:this.props.config.window_bg||("dark"===this.props.themeType?"#000":"#FFF")}),s=document.createElement("a");document.body.appendChild(s),s.href=e,s.target="_self";let i="";i=1===this.props.config.l.length?this.props.config.l[0].name:"chart";const o=this.option;if(o&&o.series&&o.series[0]&&o.series[0].data&&o.series[0].data.length){const e=new Date(o.xAxis[0].max||o.series[0].data[o.series[0].data.length-1].value[0]);try{s.download="".concat(e.getFullYear(),"_").concat((e.getMonth()+1).toString().padStart(2,"0"),"_").concat(e.getDate().toString().padStart(2,"0"))+"_".concat(e.getHours().toString().padStart(2,"0"),"_").concat(e.getMinutes().toString().padStart(2,"0"),"_").concat(i,".").concat(this.option&&this.option.useCanvas?"png":"svg"),s.click()}catch(t){console.error("Cannot access download: ".concat(t)),window.alert(w.a.t("Unfortunately your browser does not support this feature"))}}else window.alert(w.a.t("No data found"))}}}):null}render(){this.divRef.current||setTimeout((()=>this.forceUpdate()),10);const t="noborder"!==this.props.config.noBorder&&parseFloat(this.props.config.border_width)||0,e=parseFloat(this.props.config.border_padding)||0;return Object(Y.jsxs)("div",{ref:this.divRef,className:this.props.classes.chart,style:{borderWidth:t,width:t||e?"calc(100% - ".concat(2*(t+e)+1,"px)"):void 0,height:t||e?"calc(100% - ".concat(2*(t+e),"px)"):void 0,background:this.props.config.noBackground?void 0:this.props.config.window_bg||void 0,borderColor:"noborder"!==this.props.config.noBorder&&this.props.config.border_color||void 0,borderStyle:"noborder"!==this.props.config.noBorder&&t?this.props.config.border_style||"solid":"hidden",padding:e||0},children:[this.renderExportButton(),this.renderResetButton(),null!==this.state.chartHeight?this.renderChart():null]})}}var q=Object(u.a)()(Object(l.a)((t=>({chart:{maxHeight:"100%",maxWidth:"100%",width:"100%",height:"100%",overflow:"hidden",position:"relative"},exportButton:{position:"absolute",top:40,right:5,width:20,height:20,zIndex:2,opacity:.7,cursor:"pointer"},resetButton:{position:"absolute",top:10,right:25,zIndex:2,opacity:.7},resetButtonIcon:{paddingTop:6}})))(Z));class $ extends i.Component{constructor(t){super(t),this.onReceiveMessage=t=>{if(t&&"chartReady"!==t.data)try{const e=JSON.parse(t.data);this.chartData?this.chartData.setConfig(e):this.createChartData(e)}catch(e){return console.log("Cannot parse "+t.data)}};const e=this.createTheme(),i=v.a.parseQuery(window.location.search),a=v.a.parseQuery((window.location.hash||"").replace(/^#/,""));this.state={connected:!1,seriesData:null,actualValues:null,noLoader:i.noLoader||a.noLoader||!1,theme:e,themeName:this.getThemeName(e),themeType:this.getThemeType(e),noBackground:i.noBG||a.noBG||!1},this.inEdit="1"===i.edit||1===i.edit||!0===i.edit||"true"===i.edit||"1"===a.edit||1===a.edit||!0===a.edit||"true"===a.edit,this.divRef=o.a.createRef(),this.progressRef=o.a.createRef(),this.progressShown=!0;const n={en:s(955),de:s(956),ru:s(957),pt:s(958),nl:s(959),fr:s(960),it:s(961),es:s(962),pl:s(963),"zh-cn":s(964)},r={en:s(965),de:s(966),ru:s(967),pt:s(968),nl:s(969),fr:s(970),it:s(971),es:s(972),pl:s(973),"zh-cn":s(974)};Object.keys(n).forEach((t=>n[t]=Object.assign(n[t],r[t]))),w.a.setTranslations(n);try{this.isIFrame=window.self!==window.top}catch(h){this.isIFrame=!0}this.socket=new D.a({name:window.adapterName,onProgress:t=>{t===S.PROGRESS.CONNECTING?this.state.seriesData?(this.divRef.current&&(this.divRef.current.style.opacity=.5),this.progressRef.current&&(this.progressRef.current.style.display="block")):this.setState({connected:!1}):(S.PROGRESS.READY,this.setState({connected:!0}),this.restoreAfterReconnection())},onReady:(t,e)=>{w.a.setLanguage(this.socket.systemLang),this.socket.getSystemConfig().then((t=>{var e,s;if(this.systemLang=(null===t||void 0===t||null===(e=t.common)||void 0===e?void 0:e.language)||"en",this.isFloatComma=(null===t||void 0===t||null===(s=t.common)||void 0===s?void 0:s.isFloatComma)||!1,this.inEdit){if(window.addEventListener("message",this.onReceiveMessage),window.self!==window.parent)try{window.parent.postMessage("chartReady","*")}catch(h){console.warn("Cannot send ready event to parent window"),console.error(h)}}else this.createChartData()})).catch((t=>{t===S.ERRORS.NOT_CONNECTED?this.setState({connected:!1}):this.showError(w.a.t(t))}))},onError:t=>{console.error(t),this.showError(t)}})}restoreAfterReconnection(){this.divRef.current&&(this.divRef.current.style.opacity=1),this.progressRef.current&&!this.progressShown&&(this.progressRef.current.style.display="none"),this.state.seriesData&&!this.state.seriesData.find((t=>t.length))&&this.chartData.setNewRange()}createChartData(t){this.chartData=new E(this.socket,t),this.chartData.onError((t=>{t===S.ERRORS.NOT_CONNECTED?(this.divRef.current&&(this.divRef.current.style.opacity=.5),this.progressRef.current&&(this.progressRef.current.style.display="block")):this.showError(w.a.t(t))})),this.chartData.onReading((t=>this.showProgress(t))),this.chartData.onUpdate(((t,e)=>{const s={connected:!0,dataLoaded:!0};t&&(s.seriesData=t),e&&(s.actualValues=e),this.setState(s,(()=>this.showProgress(!1)))}))}showProgress(t){this.progressShown=t,this.progressRef.current&&(this.progressRef.current.style.display=t?"block":"none")}componentWillUnmount(){this.inEdit&&window.removeEventListener("message",this.onReceiveMessage,!1),this.chartData&&this.chartData.destroy()}createTheme(t=""){return M()(v.a.getThemeName(t))}getThemeName(t){return t.name}getThemeType(t){return t.palette.type}showError(t){this.setState({errorText:t})}renderError(){return this.state.errorText?Object(Y.jsx)(I.a,{classes:{},text:this.state.errorText,onClose:()=>this.setState({errorText:""})}):null}componentDidUpdate(t,e,s){!this.progressShown&&this.progressRef.current&&"none"!==this.progressRef.current.style.display&&(this.progressRef.current.style.display="none")}render(){if(!this.state.connected||!this.state.seriesData)return this.state.noLoader?null:Object(Y.jsx)(r.a,{theme:this.state.theme,children:Object(Y.jsx)(y.a,{theme:this.state.themeType})});const t=this.chartData.getConfig(),e=f()(JSON.stringify((t&&t.l&&t.l.map((t=>t.id))||[]).sort())).toString();return this.state.seriesData&&t.debug&&console.log("seriesData: "+JSON.stringify(this.state.seriesData)),Object(Y.jsx)(r.a,{theme:this.state.theme,children:Object(Y.jsxs)("div",{ref:this.divRef,className:this.props.classes.root,style:{width:t.width,height:t.height,background:t.noBackground?void 0:this.state.theme.palette.background.default,color:this.state.theme.palette.text.primary},children:[Object(Y.jsx)(p.a,{ref:this.progressRef,style:{display:"block"},className:this.props.classes.progress}),Object(Y.jsx)(q,{socket:this.socket,t:w.a.t,noAnimation:this.state.noLoader,data:this.state.seriesData,actualValues:this.state.actualValues,config:t,lang:w.a.getLanguage(),themeType:this.state.themeType,onRangeChange:t=>this.chartData.setNewRange(t)},e),this.renderError()]})})}}var Q=Object(u.a)()(Object(l.a)((t=>({root:{width:"100%",height:"100%",position:"relative"},progress:{position:"absolute",top:0,left:0,right:0}})))(Object(d.a)($)));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var K=s(270);window.adapterName="echarts-show";let tt=v.a.getThemeName();console.log("iobroker."+window.adapterName+"@"+K.a+' using theme "'+tt+'"'),"localhost:3000"!==window.location.host&&h.a({dsn:"https://cf39325071144219aa91bb3510addcdf@sentry.iobroker.net/95",release:"iobroker."+window.adapterName+"@"+K.a,integrations:[new c.a],beforeSend:function(t,e){let s=!1;return t.exception&&t.exception.values&&t.exception.values[0]&&("NS_ERROR_FAILURE"===t.exception.values[0].type||t.exception.values[0].value&&(t.exception.values[0].value.includes("Microsoft YaHei")||"ResizeObserver loop completed with undelivered notifications."===t.exception.values[0].value||"undefined is not an object (evaluating 't.get')"===t.exception.values[0].value||"Cannot read property 'get' of undefined"===t.exception.values[0].value||"this.painter is null"===t.exception.values[0].value||t.exception.values[0].value.includes("ioBroker is not connected")||"Cannot read property 'getDisplayList' of null"===t.exception.values[0].value))&&(s=!0),s?null:t}}),function t(){return n.a.render(Object(Y.jsx)(r.a,{theme:M()(tt),children:Object(Y.jsx)(Q,{onThemeChange:e=>{tt=e,t()}})}),document.getElementById("root"))}(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((t=>{t.unregister()}))}},[[977,1,2]]]);
//# sourceMappingURL=main.c1e2fbb3.chunk.js.map