(this["webpackJsonpecharts.index"]=this["webpackJsonpecharts.index"]||[]).push([[0],{153:function(e){e.exports=JSON.parse('{"a":"0.0.1"}')},236:function(e,t,i){e.exports=i(453)},241:function(e,t,i){},441:function(e){e.exports=JSON.parse('{"Save as image":"Save as image","Reset pan and zoom":"Reset pan and zoom"}')},442:function(e){e.exports=JSON.parse('{"Save as image":"Als Bild speichern","Reset pan and zoom":"Verschiebung und Zoomen zur\xfccksetzen"}')},443:function(e){e.exports=JSON.parse('{"Save as image":"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435","Reset pan and zoom":"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0441\u0434\u0432\u0438\u0433 \u0438 \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435"}')},444:function(e){e.exports=JSON.parse('{"Save as image":"Salvar como imagem","Reset pan and zoom":"Redefinir panor\xe2mica e zoom"}')},445:function(e){e.exports=JSON.parse('{"Save as image":"Bewaar als afbeelding","Reset pan and zoom":"Stel pannen en zoomen opnieuw in"}')},446:function(e){e.exports=JSON.parse('{"Save as image":"Enregistrer comme image","Reset pan and zoom":"R\xe9initialiser le panoramique et le zoom"}')},447:function(e){e.exports=JSON.parse('{"Save as image":"Salva come immagine","Reset pan and zoom":"Reimposta panoramica e zoom"}')},448:function(e){e.exports=JSON.parse('{"Save as image":"Guardar como imagen","Reset pan and zoom":"Restablecer panor\xe1mica y zoom"}')},449:function(e){e.exports=JSON.parse('{"Save as image":"Zapisz jako obraz","Reset pan and zoom":"Zresetuj przesuwanie i powi\u0119kszanie"}')},450:function(e){e.exports=JSON.parse('{"Save as image":"\u53e6\u5b58\u4e3a\u56fe\u7247","Reset pan and zoom":"\u91cd\u7f6e\u5e73\u79fb\u548c\u7f29\u653e"}')},453:function(e,t,i){"use strict";i.r(t);var o=i(0),a=i.n(o),n=i(22),s=i.n(n),r=i(478),c=(i(484),i(483),i(241),i(70)),l=i(71),h=i(117),u=i(115),d=i(10),g=i(164),f=i(485),m=i(480),p=i(34),v=i.n(p),y=i(220),w=i.n(y),x=i(33),b=i.n(x),k=i(118),S=i.n(k),D=i(221),I=i.n(D),M=i(113),T=i.n(M);i(266);function z(e){if(e.lines&&(e.l=JSON.parse(JSON.stringify(e.lines)),delete e.lines),e._ids){var t=e._ids?e._ids.split(";"):[],i=e._colors?e._colors.split(";"):[],o=e._names?e._names.split(";"):[],a=e._units?e._units.split(";"):[];e.l=[];for(var n=0;n<t.length;n++)e.l.push({id:t[n],offset:0,name:o[n]||"",aggregate:"onchange",color:i[n]||"blue",thickness:e.strokeWidth||1,shadowsize:e.strokeWidth||1,min:e.min||"",max:e.max||"",unit:a[n]||""});e.aggregateType="step",e.aggregateSpan=300,e.relativeEnd="now"}if(e.l)for(var s=0;s<e.l.length;s++)e.l[s].art&&(e.l[s].aggregate=e.l[s].art,delete e.l[s].art),e.instance&&!e.l[s].instance&&(e.l[s].instance=e.instance);if(e.l=e.l||[],e.m){e.marks=[];for(var r=0;r<e.m.length;r++)e.marks[r]={lineId:e.m[r].l,upperValueOrId:e.m[r].v,lowerValueOrId:e.m[r].vl,color:e.m[r].c,fill:e.m[r].f,ol:e.m[r].t,os:e.m[r].s,text:e.m[r].d,textPosition:e.m[r].p,textOffset:e.m[r].py,textColor:e.m[r].fc,textSize:e.m[r].fs};delete e.m}return e.marks=e.marks||[],e.l.length||e.l.push({id:"",unit:""}),e.width=e.width||"100%",e.height=e.height||"100%",e.timeFormat=e.timeFormat||"%H:%M:%S %e.%m.%y",e.useComma="true"===e.useComma||!0===e.useComma,e.zoom="true"===e.zoom||!0===e.zoom,e.export="true"===e.export||!0===e.export,e.grid_hideX="true"===e.grid_hideX||!0===e.grid_hideX,e.grid_hideY="true"===e.grid_hideY||!0===e.grid_hideY,e.hoverDetail="true"===e.hoverDetail||!0===e.hoverDetail,e.noLoader="true"===e.noLoader||!0===e.noLoader,e.noedit="true"===e.noedit||!0===e.noedit,e.animation=parseInt(e.animation)||0,e.afterComma=void 0===e.afterComma?2:parseInt(e.afterComma,10),e.timeType=e.timeType||"relative",e}var O=function(){function e(t,i,o){var a=this;Object(c.a)(this,e),this.onHashChange=function(){a.lastHash!==window.location.hash&&(a.lastHash=window.location.hash,a.analyseAndLoadConfig())},this.onPresetUpdate=function(e,t){e===a.preset&&(a.presetUpdateTimeout&&clearTimeout(a.presetUpdateTimeout),a.presetUpdateTimeout=setTimeout((function(){var e;a.presetUpdateTimeout=null,e=z(t?t.native.data:{}),JSON.stringify(e)!==JSON.stringify(a.config)&&(a.config=e,a.updateInterval&&clearInterval(a.updateInterval),a.updateInterval=null,!a.config.live||a.zoomData&&a.zoomData.stopLive||(a.updateInterval=setInterval((function(){return a.readData()}),1e3*a.config.live)),a.readData())}),100))},o=Object.assign({updateTimeout:300},o||{}),this.socket=t,this.updateTimeout=o.updateTimeout||300,this.seriesData=[],this.ticks=null,this.liveInterval=null,this.navOptions={},this.sessionId=1,this.updateInterval=null,this.presetSubscribed=!1,this.onUpdateFunc=null,this.onReadingFunc=null,this.onErrorFunc=null,this.objectPromises={},this.lastHash=window.location.hash,this.debug=!1,this.zoomData=null,i||(this.onHashInstalled=!0,window.addEventListener("hashchange",this.onHashChange,!1)),this.socket.getSystemConfig().then((function(e){return a.systemConfig=e&&e.common?e.common:{},a.analyseAndLoadConfig(i)}))}return Object(l.a)(e,[{key:"analyseAndLoadConfig",value:function(e){var t=this;if(e)"string"===typeof e?this.preset=e:this.config=e;else{var i=v.a.parseQuery(window.location.search);if(this.debug=!0===i.debug||"true"===i.debug||1===i.debug||"1"===i.debug,i.preset)this.preset=i.preset;else{var o=v.a.parseQuery((window.location.hash||"").toString().replace(/^#/,""));if(o.data)try{o.data=JSON.parse(o.data)}catch(n){o.data={}}if(i.data)try{i.data=JSON.parse(i.data)}catch(n){i.data={}}var a=Object.assign(i.data||{},o.data||{},!0);void 0!==o.noLoader&&(a.noLoader=o.noLoader),void 0!==i.noLoader&&(a.noLoader=i.noLoader),this.config=z(a)}}this.seriesData=[],this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null),this.preset?(this.preset.startsWith("echarts.")&&this.preset.startsWith("flot.")&&this.preset.includes(".")||(this.preset="echarts.0."+this.preset),this.socket.getObject(this.preset).then((function(e){if(!e||!e.native||!e.native.data||"chart"!==e.type)return console.error("[ChartModel] Invalid object ".concat(t.preset,": ").concat(JSON.stringify(e)));t.config=z(e.native.data),t.config.useComma=void 0===t.config.useComma?!0===t.systemConfig.isFloatComma||"true"===t.systemConfig.isFloatComma:"true"===t.config.useComma||!0===t.config.useComma,t.config.lang=t.systemConfig.language,t.config.live=parseInt(t.config.live,10)||0,t.config.debug=t.debug,t.readData(),t.presetSubscribed!==t.preset&&(t.presetSubscribed&&t.socket.unsubscribeObject(t.presetSubscribed,t.onPresetUpdate),t.presetSubscribed=t.preset,t.socket.subscribeObject(t.preset,t.onPresetUpdate)),!t.config.live||t.zoomData&&t.zoomData.stopLive||(t.updateInterval=setInterval((function(){return t.readData()}),1e3*t.config.live))}))):(this.config.useComma=void 0===this.config.useComma?!0===this.systemConfig.isFloatComma||"true"===this.systemConfig.isFloatComma:"true"===this.config.useComma||!0===this.config.useComma,this.config.lang=this.systemConfig.language,this.config.live=parseInt(this.config.live,10)||0,this.config.debug=this.debug,this.readData(),!this.config.live||this.zoomData&&this.zoomData.stopLive||(this.updateInterval=setInterval((function(){return t.readData()}),1e3*this.config.live)))}},{key:"setNewRange",value:function(e){var t=this;if(this.debug&&console.log("[ChartModel] [".concat((new Date).toISOString(),"] setNewRange: ").concat(JSON.stringify(e))),e)if(e.stopLive)this.zoomData=this.zoomData||{},this.zoomData.stopLive=!0,this.updateInterval&&(console.log("Clear interval"),clearInterval(this.updateInterval),this.updateInterval=null);else{var i=this.zoomData&&this.zoomData.stopLive;i&&delete this.zoomData.stopLive,this.zoomData&&JSON.stringify(this.zoomData)===JSON.stringify(e)?i&&(this.zoomData.stopLive=!0):(this.zoomData=e,i&&(this.zoomData.stopLive=!0),this.readOnZoomTimeout&&clearTimeout(this.readOnZoomTimeout),this.readOnZoomTimeout=setTimeout((function(){t.readOnZoomTimeout=null,t.readData()}),this.updateTimeout))}else this.zoomData&&(this.zoomData=null,this.readOnZoomTimeout&&clearTimeout(this.readOnZoomTimeout),this.readOnZoomTimeout=setTimeout((function(){t.readOnZoomTimeout=null,!t.config.live||t.zoomData&&t.zoomData.stopLive||(console.log("Restore update"),t.updateInterval&&clearInterval(t.updateInterval),t.updateInterval=setInterval((function(){return t.readData()}),1e3*t.config.live)),t.readData()}),this.updateTimeout))}},{key:"destroy",value:function(){this.readOnZoomTimeout&&(clearTimeout(this.readOnZoomTimeout),this.readOnZoomTimeout=null),this.presetUpdateTimeout&&(clearTimeout(this.presetUpdateTimeout),this.presetUpdateTimeout=null),this.presetSubscribed&&(this.socket.unsubscribeObject(this.presetSubscribed,this.onPresetUpdate),this.presetSubscribed=null),this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null),this.onHashInstalled&&window.removeEventListener("hashchange",this.onHashChange,!1),this.onHashInstalled=!1}},{key:"onUpdate",value:function(e){this.onUpdateFunc=e}},{key:"onReading",value:function(e){this.onReadingFunc=e}},{key:"onError",value:function(e){this.onErrorFunc=e}},{key:"getConfig",value:function(){return this.config}},{key:"getStartStop",value:function(e,t){var i,o,a,n={};if(this.config.l[e].offset=this.config.l[e].offset||0,"string"===typeof this.config.range&&this.config.range.includes("m")&&this.config.l.length>1)for(var s=parseInt(this.config.range,10)||1,r=0;r<this.config.l.length;r++)if(this.config.l[r].offset&&0!==this.config.l[r].offset){a=this.addTime(this.now,this.config.l[0].offset);var c=new Date(a);c.setMonth(c.getMonth()-s),this.config.range=Math.floor((a-c.getTime())/6e4)+"";break}if(t)return this.zoomData?(o=this.zoomData.start,i=this.zoomData.end):o=(i=this.addTime(this.now,this.config.l[e].offset))-t,n={start:o,end:i,ignoreNull:void 0===this.config.l[e].ignoreNull?this.config.ignoreNull:this.config.l[e].ignoreNull,aggregate:this.config.l[e].aggregate||this.config.aggregate||"minmax",count:1,from:!1,ack:!1,q:!1,addID:!1},this.config.start=this.addTime(i,this.config.range,!1,!0),this.config.end=i,n;if(this.zoomData)o=this.zoomData.start,i=this.zoomData.end;else if("static"===this.config.timeType){var l,h;l=void 0!==this.config.start_time?this.config.start_time.split(":").map(Number):[0,0],h=void 0!==this.config.end_time?this.config.end_time.split(":").map(Number):[24,0],o=new Date(this.config.start).setHours(l[0],l[1]),i=new Date(this.config.end).setHours(h[0],h[1]),o=this.addTime(o,this.config.l[e].offset),i=this.addTime(i,this.config.l[e].offset)}else{if(this.config.relativeEnd=this.config.relativeEnd||"now","now"===this.config.relativeEnd)a=new Date(this.now);else if(-1!==this.config.relativeEnd.indexOf("minute")){var u=parseInt(this.config.relativeEnd,10)||1;(a=new Date(this.now)).setMinutes(Math.floor(a.getMinutes()/u)*u+u),a.setSeconds(0),a.setMilliseconds(0)}else if(-1!==this.config.relativeEnd.indexOf("hour")){var d=parseInt(this.config.relativeEnd,10)||1;(a=new Date(this.now)).setHours(Math.floor(a.getHours()/d)*d+d),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)}else"today"===this.config.relativeEnd?((a=new Date(this.now)).setDate(a.getDate()+1),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)):"weekUsa"===this.config.relativeEnd?((a=new Date(this.now)).setDate(a.getDate()-a.getDay()+7),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)):"weekEurope"===this.config.relativeEnd?(0===(a=new Date(this.now)).getDay()?a.setDate(a.getDate()+1):a.setDate(a.getDate()-a.getDay()+8),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)):"month"===this.config.relativeEnd?((a=new Date(this.now)).setMonth(a.getMonth()+1),a.setDate(1),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)):"year"===this.config.relativeEnd&&((a=new Date(this.now)).setFullYear(a.getFullYear()+1),a.setMonth(0),a.setDate(1),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0));this.config.range=this.config.range||"30m",i=this.addTime(a,this.config.l[e].offset),o=this.addTime(i,this.config.range,!1,!0)}return n={start:o,end:i,ignoreNull:void 0===this.config.l[e].ignoreNull?this.config.ignoreNull:this.config.l[e].ignoreNull,aggregate:this.config.l[e].aggregate||this.config.aggregate||"minmax",from:!1,ack:!1,q:!1,addID:!1},"step"===this.config.aggregateType?n.step=1e3*this.config.aggregateSpan:"count"===this.config.aggregateType&&(n.count=this.config.aggregateSpan||this.chartRef.current.clientWidth/10),this.config.start=o,this.config.end=i,n}},{key:"readOneChart",value:function(e,t,i,o){var a=this,n=this.getStartStop(i);n.instance=t,n.sessionId=this.sessionId,this.config.l[i].yOffset=parseFloat(this.config.l[i].yOffset)||0,this.debug&&console.log("[ChartModel] "+new Date(n.start)+" - "+new Date(n.end)),this.socket.getHistoryEx(e,n).then((function(e){if(a.sessionId&&e.sessionId&&e.sessionId!==a.sessionId)return console.warn("[ChartModel] Ignore request with sessionId=".concat(e.sessionId,", actual is ").concat(a.sessionId));if(e&&e.values){n.yOffset=a.config.l[i].yOffset;var t=e.values;a.seriesData[i]=[];for(var o=a.seriesData[i],s=0;s<t.length;s++)"true"===t[s].val||!0===t[s].val?t[s].val=1:"false"!==t[s].val&&!1!==t[s].val||(t[s].val=0),"string"===typeof t[s].val&&(t[s].val=parseFloat(t[s].val)),o.push({value:[t[s].ts,null!==t[s].val?t[s].val+n.yOffset:null]});o.length?(o[0][0]>n.start&&o.unshift({value:[n.start,null]}),o[o.length-1][0]<n.end&&o.push({value:[n.end,null]})):(o.push({value:[n.start,null]}),o.push({value:[n.end,null]})),e.values=null,e=null}return Promise.resolve()})).catch((function(e){return e&&console.error("[ChartModel] "+e)})).then((function(){return o(e,i)}))}},{key:"_readObject",value:function(e){return this.objectPromises[e]||(this.objectPromises[e]=this.socket.getObject(e)),this.objectPromises[e]}},{key:"_readOneLine",value:function(e,t){var i=this;return this._readObject(this.config.l[e].id).then((function(t){return t&&t.common&&(i.config.l[e].name=i.config.l[e].name||t.common.name,i.config.l[e].unit=i.config.l[e].unit||(t.common.unit?t.common.unit.replace("\ufffd","\xb0"):""),i.config.l[e].type=t.common.type,"auto"===i.config.l[e].chartType&&(i.config.l[e].chartType="boolean"===t.common.type?"steps":"line",i.config.l[e].aggregate="boolean"===t.common.type?"onchange":"minmax")),Promise.resolve()})).catch((function(t){return console.error("[ChartModel] Cannot read object ".concat(i.config.l[e].id,": ").concat(t)),Promise.resolve()})).then((function(){i.config.l[e].name=i.config.l[e].name||i.config.l[e].id,i.config.l[e].unit=i.config.l[e].unit||"","auto"===i.config.l[e].chartType&&(i.config.l[e].chartType="line",i.config.l[e].aggregate="minmax"),"object"===typeof i.config.l[e].name&&(i.config.l[e].name=i.config.l[e].name[i.systemConfig.language]||i.config.l[e].name.en),i.readOneChart(i.config.l[e].id,i.config.l[e].instance,e,t)}))}},{key:"_readData",value:function(e,t){var i=this;if((t=t||0)>=this.config.l.length)return e();""!==this.config.l[t]&&void 0!==this.config.l[t]&&this.seriesData.push([]),this._readOneLine(t,(function(){return setTimeout((function(){return i._readData(e,t+1)}),10)}))}},{key:"readTicks",value:function(e){var t=this;if(this.config.ticks){var i=JSON.parse(JSON.stringify(this.getStartStop(0)));i.instance=this.config.l[0].instance,i.sessionId=this.sessionId,i.aggregate="onchange",this.debug&&console.log("[ChartModel] Ticks: "+new Date(i.start)+" - "+new Date(i.end)),this.socket.getHistoryEx(this.config.ticks,i).then((function(e){if(t.sessionId&&e.sessionId&&e.sessionId!==t.sessionId)return console.warn("[ChartModel] Ignore request with sessionId=".concat(e.sessionId,", actual is ").concat(t.sessionId));if(e&&e.values){var o=t.ticks||[];t.ticks&&t.ticks.length&&t.ticks.splice(0,t.ticks.length);for(var a=e.values,n=0;n<a.length;n++)null!==a[n].val&&o.push({value:[a[n].ts,a[n].val]});o.length?(o[0][0]>i.start&&o.unshift({value:[i.start,""]}),o[o.length-1][0]<i.end&&o.push({value:[i.end,""]})):(o.push({value:[i.start,""]}),o.push({value:[i.end,""]})),e.values=null,e=null,t.ticks=o}return Promise.resolve()})).catch((function(e){return console.error("[ChartModel] ".concat(e))})).then((function(){return e&&e(t.ticks)}))}else e(null)}},{key:"readValue",value:function(e,t,i){this.socket.getState(e).then((function(e){i(t,e&&parseFloat(e.val)||0)})).catch((function(e){console.error("[ChartModel] ".concat(e)),i(t,0)}))}},{key:"readMarkings",value:function(e,t){var i=this;return t=t||0,!this.config.marks||!this.config.marks.length||t>=this.config.marks.length?e():new Promise((function(e){(i.config.marks[t].upperValueOrId||0===i.config.marks[t].upperValueOrId)&&parseFloat(i.config.marks[t].upperValueOrId).toString()!==i.config.marks[t].upperValueOrId.toString().replace(/\.0*$/,"")&&i.config.marks[t].upperValueOrId.toString().includes(".")?i.socket.getState(i.config.marks[t].upperValueOrId).then((function(o){o&&void 0!==o.val&&null!==o.val?i.config.marks[t].upperValue=parseFloat(o.val)||0:i.config.marks[t].upperValue=null,e()})):e()})).then((function(){return new Promise((function(e){(i.config.marks[t].lowerValueOrId||0===i.config.marks[t].lowerValueOrId)&&parseFloat(i.config.marks[t].lowerValueOrId).toString()!==i.config.marks[t].lowerValueOrId.replace(/\.0*$/,"")&&i.config.marks[t].lowerValueOrId.includes(".")?i.socket.getState(i.config.marks[t].lowerValueOrId).then((function(o){o&&void 0!==o.val&&null!==o.val?i.config.marks[t].lowerValue=parseFloat(o.val)||0:i.config.marks[t].lowerValue=null,e()})):e()}))})).then((function(){return setTimeout((function(){return i.readMarkings(e,t+1)}),0)}))}},{key:"addTime",value:function(e,t,i,o){return e=new Date(e),"string"===typeof t?"m"===t[1]?(t=parseInt(t,10),e.setMonth(i?e.getMonth()+t:e.getMonth()-t),e=e.getTime()):"y"===t[1]?(t=parseInt(t,10),e.setFullYear(i?e.getFullYear()+t:e.getFullYear()-t),e=e.getTime()):(e=e.getTime(),o?i?e+=6e4*(parseInt(t,10)||0):e-=6e4*(parseInt(t,10)||0):i?e+=1e3*(parseInt(t,10)||0):e-=1e3*(parseInt(t,10)||0)):(e=e.getTime(),o?i?e+=6e4*(parseInt(t,10)||0):e-=6e4*(parseInt(t,10)||0):i?e+=1e3*(parseInt(t,10)||0):e-=1e3*(parseInt(t,10)||0)),e}},{key:"readData",value:function(){var e=this;this.readOnZoomTimeout&&(clearTimeout(this.readOnZoomTimeout),this.readOnZoomTimeout=null),this.now=Date.now(),this.sessionId=this.sessionId||0,this.sessionId++,this.sessionId>16777215&&(this.sessionId=1),this.config.l?(this.onReadingFunc&&this.onReadingFunc(!0),this.seriesData=[],this._readData((function(){return e.readTicks((function(t){return e.readMarkings((function(){e.onUpdateFunc(e.seriesData)}))}))}))):(this.onErrorFunc&&this.onErrorFunc("No config provided"),this.onReadingFunc&&this.onReadingFunc(!1))}}]),e}(),R=i(481),C=i(224),N=i(27),E=i.n(N),F=(i(268),i(269),i(270),i(271),i(272),i(273),i(274),i(275),i(276),i(277),i(222)),L=i.n(F),_=i(7),A=i.n(_);i(344),i(362),i(366),i(375),i(376),i(382),i(385),i(401),i(402),i(407),i(416),i(425);function j(e){return e.toString().padStart(2,"0")}var P=null;function H(e,t,i){var o=(P||(P=document.createElement("canvas"))).getContext("2d");o.font="".concat(t||12,"px ").concat(i||"Microsoft YaHei");var a=o.measureText(e);return Math.ceil(a.width)}var V=function(e){Object(h.a)(i,e);var t=Object(u.a)(i);function i(e){var o;return Object(c.a)(this,i),(o=t.call(this,e)).updateProperties=function(e){if(o.updatePropertiesTimeout=null,"function"===typeof o.echartsReact.getEchartsInstance){o.debug&&console.log("[ChartView ] [".concat((new Date).toISOString(),"] updateProperties"));var t=o.echartsReact.getEchartsInstance();t.clear(),t.setOption(o.getOptions(e))}},o.onResize=function(){o.timerResize&&clearTimeout(o.timerResize),o.timerResize=setTimeout((function(){o.timerResize=null,o.componentDidUpdate()}))},o.onMouseMove=function(e){if(o.mouseDown){o.divResetButton.current&&"block"!==o.divResetButton.current.style.display&&(o.divResetButton.current.style.display="block");var t=o.chart.lastX-(e.offsetX-o.chart.padLeft);o.chart.lastX=e.offsetX-o.chart.padLeft;var i=o.chart.xMax-o.chart.xMin,a=o.state.chartWidth-o.chart.padRight-o.chart.padLeft,n=Math.round(t*i/a);o.chart.xMin+=n,o.chart.xMax+=n,o.setNewRange()}},o.onMouseDown=function(e){o.mouseDown=!0,o.chart.lastX=e.offsetX,o.zr&&!o.zr._mousemove&&(o.zr._mousemove=!0,o.zr.on("mousemove",o.onMouseMove)),o.props.config.live&&o.props.onRangeChange&&(console.log("Stop update"),o.props.onRangeChange({stopLive:!0}))},o.onMouseUp=function(){o.mouseDown=!1,o.setNewRange(!0),o.zr&&o.zr._mousemove&&(o.zr._mousemove=!1,o.zr.off("mousemove",o.onMouseMove))},o.onMouseWheel=function(e){var t=o.chart.xMax-o.chart.xMin,i=o.state.chartWidth-o.chart.padRight-o.chart.padLeft,a=(e.offsetX-o.chart.padLeft)/i,n=t-(t*=e.wheelDelta>0?1.1:.9);o.chart.xMax+=n*(1-a),o.chart.xMin-=n*a,o.setNewRange(),o.updateDataTimer&&clearTimeout(o.updateDataTimer),o.updateDataTimer=setTimeout((function(){return o.setNewRange(!0)}),1e3)},o.onTouchStart=function(e){e.preventDefault(),o.mouseDown=!0;var t=e.touches||e.originalEvent.touches;t&&(o.chart.lastX=t[t.length-1].pageX,t.length>1?o.chart.lastWidth=Math.abs(t[0].pageX-t[1].pageX):o.chart.lastWidth=null)},o.onTouchEnd=function(e){e.preventDefault(),o.mouseDown=!1,o.setNewRange(!0)},o.onTouchMove=function(e){e.preventDefault();var t=e.touches||e.originalEvent.touches;if(t){var i=t[t.length-1].pageX-o.chart.padLeft;if(o.mouseDown)if(t.length>1){var a=Math.abs(t[0].pageX-t[1].pageX);if(null!==o.chart.lastWidth&&a!==o.chart.lastWidth){var n=o.chart.xMax-o.chart.xMin,s=o.state.chartWidth-o.chart.padRight-o.chart.padLeft,r=a>o.chart.lastWidth?1.1:.9,c=(t[0].pageX>t[1].pageX?t[1].pageX-o.chart.padLeft+a/2:t[0].pageX-o.chart.padLeft+a/2)/s,l=n-(n*=r);o.chart.xMax+=l*(1-c),o.chart.xMin-=l*c,o.setNewRange()}o.chart.lastWidth=a}else{var h=o.chart.lastX-i,u=o.chart.xMax-o.chart.xMin,d=o.state.chartWidth-o.chart.padRight-o.chart.padLeft,g=Math.round(h*u/d);o.chart.xMin+=g,o.chart.xMax+=g,o.setNewRange()}o.chart.lastX=i}},o.state={chartHeight:300,chartWidth:500},o.echartsReact=a.a.createRef(),o.divRef=a.a.createRef(),o.divResetButton=a.a.createRef(),o.chart={yAxis:[]},E.a.locale(b.a.getLanguage()),o}return Object(l.a)(i,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){if(e.data===this.state.data)return null;this.updatePropertiesTimeout&&clearTimeout(this.updatePropertiesTimeout),this.updatePropertiesTimeout=setTimeout(this.updateProperties,100,e)}},{key:"convertData",value:function(e,t,i){var o=(e=e||this.props).data[t];if(!o||!o.length)return[];(null===this.chart.xMin||this.chart.xMin>o[0].value[0])&&(this.chart.xMin=o[0].value[0]),(null===this.chart.xMax||this.chart.xMax<o[o.length-1].value[0])&&(this.chart.xMax=o[o.length-1].value[0]);var a=this.chart.yAxis[i]||{min:null,max:null};this.chart.yAxis[i]=a;for(var n=0;n<o.length;n++)null!==o[n].value[1]&&((null===a.min||a.min>o[n].value[1])&&(a.min=o[n].value[1]),(null===a.max||a.max<o[n].value[1])&&(a.max=o[n].value[1]));return o}},{key:"getSeries",value:function(e){var t=this;return e=e||this.props,this.chart.xMin=null,this.chart.xMax=null,e.config.l.map((function(i,o){var a=""===i.commonYAxis||void 0===i.commonYAxis?o:parseInt(i.commonYAxis)||0,n={name:i.name,xAxisIndex:0,yAxisIndex:a,type:"scatterplot"===i.chartType?"scatter":"line",showSymbol:"scatterplot"===i.chartType||i.points,hoverAnimation:!0,animation:!1,step:"steps"===i.chartType?"start":void 0,smooth:"spline"===i.chartType,data:t.convertData(e,o,a),itemStyle:{color:i.color},symbolSize:"scatterplot"===i.chartType||i.points?i.symbolSize||3:void 0,symbol:"circle",lineStyle:{width:i.thickness||1,shadowBlur:i.shadowsize?i.shadowsize+1:0,shadowOffsetY:i.shadowsize?i.shadowsize+1:0,shadowColor:i.color,type:i.dashes?"dashed":i.lineStyle||"solid"}};return i.fill&&(n.areaStyle={color:i.color,opacity:parseFloat(i.fill)}),n}))}},{key:"getYAxis",value:function(e){var t=this;return e=e||this.props,this.chart.xMin=null,this.chart.xMax=null,e.config.l.map((function(i,o){if(""!==i.commonYAxis&&void 0!==i.commonYAxis)return{};var a=parseFloat(i.min),n=parseFloat(i.max),s=t.chart.yAxis;if(s[o]){var r=s[o].max-s[o].min;isNaN(a)&&((a=s[o].min-.1*r)>0?a=0:r>5e3?a=1e3*Math.floor(a/1e3):r>200?a=100*Math.floor(a/100):r>30?a=10*Math.floor(a/10):r>10?a=Math.floor(a):r>1&&(a=Math.floor(10*a)/10)),isNaN(n)&&(n=s[o].max+.1*r,r>5e3?n=1e3*Math.ceil(n/1e3):r>200?n=100*Math.ceil(n/100):r>30?n=10*Math.ceil(n/10):r>10?n=Math.ceil(n):r>1&&(n=Math.floor(10*n)/10))}else isNaN(a)&&(a=void 0),isNaN(n)&&(n=void 0);return{type:"value",min:a,max:n,position:i.yaxe||(o?"right":"left"),splitLine:o?void 0:{show:!e.config.grid_hideY,lineStyle:e.config.grid_color?{color:e.config.grid_color}:void 0},axisLabel:{formatter:function(i){return t.yFormatter(i,o,e,!0)},color:e.config.y_labels_color||void 0},axisTick:{alignWithLabel:!0}}}))}},{key:"getMarkings",value:function(e,t){var i=this;return e.config.marks&&e.config.marks.forEach((function(o){var a=void 0!==o.lowerValue?o.lowerValue:parseFloat(o.lowerValueOrId),n=void 0!==o.upperValue?o.upperValue:parseFloat(o.upperValueOrId),s=null!==a&&!isNaN(a),r=null!==n&&!isNaN(n),c=t.series[o.lineId];if(s&&r&&(c.markArea=c.markArea||{symbol:["none","none"],itemStyle:{color:o.color||c.itemStyle.color,borderWidth:0,opacity:parseFloat(o.fill)},data:[]},c.markArea.data.push([{yAxis:a,name:o.text||""},{yAxis:n}])),s||r)for(var l=0;l<2;l++)if((l||r)&&(!l||s)){var h=l?a:n;c.markLine=c.markLine||{symbol:["none","none"],label:{show:!!o.text,formatter:o.text||"",position:"r"===o.textPosition?"end":"start",distance:o.textOffset||-35,textStyle:{color:o.textColor||"#FFF",fontStyle:"normal",fontSize:o.textSize||void 0}},lineStyle:{color:o.color||c.itemStyle.color,width:parseFloat(o.ol)||1,shadowBlur:parseFloat(o.os)?parseFloat(o.os)+1:0,shadowOffsetY:parseFloat(o.os)?parseFloat(o.os)+1:0,shadowColor:o.color,type:o.lineStyle||"solid"},data:[]},c.markLine.data.push({yAxis:h});var u=parseFloat(e.config.l[o.lineId].min);isNaN(u)&&i.chart.yAxis[o.lineId].min>h&&h<0&&(t.yAxis[0].min=h);var d=parseFloat(e.config.l[o.lineId].min);isNaN(d)&&i.chart.yAxis[o.lineId].max<h&&(t.yAxis[0].max=h)}})),t}},{key:"yFormatter",value:function(e,t,i,o){if("boolean"===(i=i||this.props).config.l[t].type)return e?"TRUE":"FALSE";if(null===e||void 0===e)return"";var a=i.config.l[t].afterComma;return void 0!==a&&null!==a?(e=parseFloat(e),i.config.useComma?e.toFixed(a).replace(".",",")+(o?i.config.l[t].unit:""):e.toFixed(a)+(o?i.config.l[t].unit:"")):i.config.useComma?(e=parseFloat(e)||0).toString().replace(".",",")+(o?i.config.l[t].unit:""):e.toString()+(o?i.config.l[t].unit:"")}},{key:"renderTooltip",value:function(e,t){var i=this,o=new Date(t[0].value[0]),a=t.filter((function(e){return!e.seriesName.startsWith("__markings__")})).map((function(t){var o=null===t.value[1]?"null":i.yFormatter(t.value[1],t.seriesIndex,e);return'<div style="width: 100%; display: inline-flex; justify-content: space-around; color: '.concat(e.config.l[t.seriesIndex].color,'">')+'<div style="display: flex;">'.concat(e.config.l[t.seriesIndex].name,":</div>")+'<div style="display: flex; flex-grow: 1"></div>'+'<div style="display: flex;"><b>'.concat(o,"</b>").concat(null!==t.value[1]?e.config.l[t.seriesIndex].unit:"","</div>")+"</div>"})),n=e.config.timeFormat||"dddd, MMMM Do YYYY, h:mm:ss.SSS";return"<b>".concat(E()(o).format(n),"</b><br/>").concat(a.join("<br/>"))}},{key:"getOptions",value:function(e){var t=this;e=e||this.props,this.debug=e.config&&e.config.debug,this.debug&&console.log("[ChartView ] [".concat((new Date).toISOString(),"] ").concat(JSON.stringify(e.config,null,2)));var i={};e.config.titlePos&&e.config.titlePos.split(";").forEach((function(e){var t=e.split(":");i[t[0].trim()]=parseInt(t[1].trim(),10)}));var o=this.getSeries(e);e.config.start&&(this.chart.xMax<e.config.end&&(this.chart.xMax=e.config.end),this.chart.xMin>e.config.start&&(this.chart.xMin=e.config.start)),this.chart.diff=this.chart.xMax-this.chart.xMin,this.chart.withTime=this.chart.diff<6048e5,this.chart.withSeconds=this.chart.diff<18e5;var a=this.getYAxis(e),n={backgroundColor:"transparent",animation:!e.config.noAnimation&&!e.config.noLoader,title:{text:e.config.title||"",textStyle:{fontSize:e.config.titleSize?parseInt(e.config.titleSize,10):void 0,color:e.config.titleColor||void 0},textVerticalAlign:i.bottom?"bottom":"top",textAlign:50===i.left?"center":-5===i.right?"right":"left",top:35===i.top?5:50===i.top?"50%":void 0,left:50===i.left?"50%":65===i.left?15:void 0,bottom:i.bottom?i.bottom>0?i.bottom+20-10:i.bottom:void 0,right:5===i.right?this.chart.padRight:void 0},grid:{backgroundColor:e.config.bg_custom||"transparent",show:!!e.config.bg_custom,left:0,top:8,right:0,bottom:40},tooltip:e.config.hoverDetail?{trigger:"axis",formatter:function(i){return t.renderTooltip(e,i)},hoverAnimation:!0,axisPointer:{animation:!0}}:void 0,xAxis:[{type:"time",splitLine:{show:!e.config.grid_hideX,lineStyle:e.config.grid_color?{color:e.config.grid_color}:void 0},min:this.chart.xMin,max:this.chart.xMax,axisTick:{alignWithLabel:!0},axisLabel:{formatter:function(i,o){var a=new Date(i);return e.config.timeFormat?E()(a).format(e.config.timeFormat).replace("<br/>","\n"):t.chart.withSeconds?j(a.getHours())+":"+j(a.getMinutes())+":"+j(a.getSeconds()):t.chart.withTime?j(a.getHours())+":"+j(a.getMinutes())+"\n"+j(a.getDate())+"."+j(a.getMonth()+1):j(a.getDate())+"."+j(a.getMonth()+1)+"\n"+a.getFullYear()},color:e.config.x_labels_color||void 0}}],yAxis:a,toolbox:!0===e.config.export||"true"===e.config.export?{left:"right",feature:{saveAsImage:{title:e.t("Save as image"),show:!0}}}:void 0,series:o};this.getMarkings(e,n);var s=0,r=0;return o.forEach((function(i,o){var a=t.yFormatter(n.yAxis[i.yAxisIndex].min,o,e,!0),c=t.yFormatter(n.yAxis[i.yAxisIndex].max,o,e,!0),l=n.yAxis[i.yAxisIndex].position,h=H(a),u=H(c);"left"===l?(h>s&&(s=h),u>s&&(s=u)):(h>r&&(r=h),u>r&&(r=u))})),n.grid.left=s+10,n.grid.right=r+10+(!0===e.config.export||"true"===e.config.export?20:0),this.chart.padLeft=n.grid.left,this.chart.padRight=n.grid.right,n.legend=e.config.legend&&"none"!==e.config.legend?{data:e.config.l.map((function(e){return e.name})),show:!0,left:"nw"===e.config.legend||"sw"===e.config.legend?this.chart.padLeft+1:void 0,right:"ne"===e.config.legend||"se"===e.config.legend?this.chart.padRight+1:void 0,top:"nw"===e.config.legend||"ne"===e.config.legend?10:void 0,bottom:"sw"===e.config.legend||"se"===e.config.legend?40:void 0,backgroundColor:e.config.legBg||void 0}:void 0,e.config.grid_color||(n.yAxis.forEach((function(e){return e.splitLine&&delete e.splitLine.lineStyle})),n.xAxis.forEach((function(e){return e.splitLine&&delete e.splitLine.lineStyle}))),n}},{key:"setNewRange",value:function(e){this.chart.diff=this.chart.xMax-this.chart.xMin,this.chart.withTime=this.chart.diff<6048e5,this.chart.withSeconds=this.chart.diff<18e5,this.debug&&console.log("[ChartView ] [".concat((new Date).toISOString(),"] setNewRange: ").concat(!!e)),e?(this.updateDataTimer&&clearTimeout(this.updateDataTimer),this.updateDataTimer=null,this.props.onRangeChange&&this.props.onRangeChange({start:this.chart.xMin,end:this.chart.xMax})):(this.debug&&console.log("[ChartView ] [".concat((new Date).toISOString(),"] setOption in setNewRange")),this.echartsReact.getEchartsInstance().setOption({xAxis:{min:this.chart.xMin,max:this.chart.xMax}}))}},{key:"installEventHandlers",value:function(){this.zr=this.echartsReact.getEchartsInstance().getZr(),this.zr&&this.props.config.zoom&&!this.zr._iobInstalled?(this.zr._iobInstalled=!0,this.zr.on("mousedown",this.onMouseDown),this.zr.on("mouseup",this.onMouseUp),this.zr.on("mousewheel",this.onMouseWheel),this.zr.on("touchstart",this.onTouchStart),this.zr.on("touchend",this.onTouchEnd),this.zr.on("touchmove",this.onTouchMove)):this.zr&&!this.props.config.zoom&&this.zr._iobInstalled&&(this.zr._iobInstalled=!1,this.zr.off("mousedown",this.onMouseDown),this.zr.off("mouseup",this.onMouseUp),this.zr.off("mousewheel",this.onMouseWheel),this.zr&&this.zr._mousemove&&(this.zr._mousemove=!1,this.zr.off("mousemove",this.onMouseMove)),this.zr.off("touchstart",this.onTouchStart),this.zr.off("touchend",this.onTouchEnd),this.zr.off("touchmove",this.onTouchMove))}},{key:"renderChart",value:function(){var e=this;if(this.props.data){var t=this.getOptions();return this.debug&&console.log("[ChartView ] [".concat((new Date).toISOString(),"] render chart")),a.a.createElement(L.a,{ref:function(t){return e.echartsReact=t},echarts:A.a,option:t,notMerge:!0,lazyUpdate:!0,theme:"dark"===this.props.themeType?"dark":"",style:{height:this.state.chartHeight+"px",width:"100%"},opts:{renderer:"svg"},onEvents:{rendered:function(t){e.props.config.zoom&&e.installEventHandlers()}}})}return a.a.createElement(m.a,null)}},{key:"componentDidUpdate",value:function(){var e=this;if(this.divRef.current){var t="noborder"!==this.props.config.noBorder&&parseFloat(this.props.config.border_width)||0,i=parseFloat(this.props.config.border_padding)||0,o=this.divRef.current.offsetHeight-2*(t+i);if(this.state.chartHeight!==o){var a=this.divRef.current.offsetWidth-2*(t+i);setTimeout((function(){return e.setState({chartHeight:o,chartWidth:a})}),10)}}}},{key:"renderResetButton",value:function(){var e=this;return a.a.createElement(R.a,{ref:this.divResetButton,size:"small",color:"default",style:{display:"none"},className:this.props.classes.resetButton,title:b.a.t("Reset pan and zoom"),onClick:function(){e.divResetButton.current&&(e.divResetButton.current.style.display="none"),e.props.onRangeChange&&e.props.onRangeChange()}},a.a.createElement(C.a,{className:this.props.classes.resetButtonIcon}))}},{key:"render",value:function(){var e=this;this.divRef.current||setTimeout((function(){return e.forceUpdate()}),10);var t="noborder"!==this.props.config.noBorder&&parseFloat(this.props.config.border_width)||0,i=parseFloat(this.props.config.border_padding)||0;return a.a.createElement("div",{ref:this.divRef,className:this.props.classes.chart,style:{borderWidth:t,width:t||i?"calc(100% - "+(2*(t+i)+1)+"px":void 0,height:t||i?"calc(100% - "+2*(t+i)+"px":void 0,background:this.props.config.window_bg||void 0,borderColor:"noborder"!==this.props.config.noBorder&&this.props.config.border_color||void 0,borderStyle:"noborder"!==this.props.config.noBorder&&t?this.props.config.border_style||"solid":"hidden",padding:i||0}},this.renderResetButton(),this.renderChart())}}]),i}(a.a.Component),W=Object(f.a)()(Object(d.a)((function(e){return{chart:{maxHeight:"100%",maxWidth:"100%",width:"100%",height:"100%",overflow:"hidden",position:"relative"},resetButton:{position:"absolute",top:10,right:25,zIndex:2,opacity:.7},resetButtonIcon:{paddingTop:6}}}))(V)),B=function(e){Object(h.a)(o,e);var t=Object(u.a)(o);function o(e){var n;Object(c.a)(this,o);var s=(n=t.call(this,e)).createTheme();n.state={connected:!1,seriesData:null,noLoader:v.a.parseQuery(window.location.search).noLoader||v.a.parseQuery((window.location.hash||"").replace(/^#/,"")).noLoader||!1,theme:s,themeName:n.getThemeName(s),themeType:n.getThemeType(s),noBackground:v.a.parseQuery(window.location.search).noBG||v.a.parseQuery((window.location.hash||"").replace(/^#/,"")).noBG||!1},n.divRef=a.a.createRef(),n.progressRef=a.a.createRef();var r={en:i(431),de:i(432),ru:i(433),pt:i(434),nl:i(435),fr:i(436),it:i(437),es:i(438),pl:i(439),"zh-cn":i(440)},l={en:i(441),de:i(442),ru:i(443),pt:i(444),nl:i(445),fr:i(446),it:i(447),es:i(448),pl:i(449),"zh-cn":i(450)};Object.keys(r).forEach((function(e){return r[e]=Object.assign(r[e],l[e])})),b.a.setTranslations(r);try{n.isIFrame=window.self!==window.top}catch(h){n.isIFrame=!0}return n.socket=new S.a({name:window.adapterName,onProgress:function(e){e===k.PROGRESS.CONNECTING?n.setState({connected:!1}):(k.PROGRESS.READY,n.setState({connected:!0}))},onReady:function(e,t){b.a.setLanguage(n.socket.systemLang),n.socket.getSystemConfig().then((function(e){var t,i;n.systemLang=(null===e||void 0===e||null===(t=e.common)||void 0===t?void 0:t.language)||"en",n.isFloatComma=(null===e||void 0===e||null===(i=e.common)||void 0===i?void 0:i.isFloatComma)||!1,n.chartData=new O(n.socket),n.chartData.onError((function(e){return n.showError(b.a.t(e))})),n.chartData.onReading((function(e){return n.showProgress(e)})),n.chartData.onUpdate((function(e){return n.setState({seriesData:e},(function(){return n.showProgress(!1)}))}))}))},onError:function(e){console.error(e),n.showError(e)}}),n}return Object(l.a)(o,[{key:"showProgress",value:function(e){this.progressRef.current&&(this.progressRef.current.style.display=e?"block":"none")}},{key:"componentWillUnmount",value:function(){this.chartData&&this.chartData.destroy()}},{key:"createTheme",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return T()(v.a.getThemeName(e))}},{key:"getThemeName",value:function(e){return e.name}},{key:"getThemeType",value:function(e){return e.palette.type}},{key:"showError",value:function(e){this.setState({errorText:e})}},{key:"renderError",value:function(){var e=this;return this.state.errorText?a.a.createElement(I.a,{classes:{},text:this.state.errorText,onClose:function(){return e.setState({errorText:""})}}):null}},{key:"render",value:function(){var e=this;if(!this.state.connected||!this.state.seriesData)return this.state.noLoader?null:a.a.createElement(r.a,{theme:this.state.theme},a.a.createElement(w.a,{theme:this.state.themeType}));var t=this.chartData.getConfig();return this.state.seriesData&&t.debug&&console.log("seriesData: "+JSON.stringify(this.state.seriesData)),a.a.createElement(r.a,{theme:this.state.theme},a.a.createElement("div",{ref:this.divRef,className:this.props.classes.root,style:{width:t.width,height:t.height,background:this.state.noBackground?void 0:this.state.theme.palette.background.default,color:this.state.theme.palette.text.primary}},a.a.createElement(m.a,{ref:this.progressRef,style:{display:"block"},className:this.props.classes.progress}),a.a.createElement(W,{socket:this.socket,t:b.a.t,noAnimation:this.state.noLoader,data:this.state.seriesData,config:t,lang:b.a.getLanguage(),themeType:this.state.themeType,onRangeChange:function(t){return e.chartData.setNewRange(t)}}),this.renderError()))}}]),o}(o.Component),U=Object(f.a)()(Object(d.a)((function(e){return{root:{width:"100%",height:"100%",position:"relative"},progress:{position:"absolute",top:0,left:0,right:0}}}))(Object(g.a)(B)));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var J=i(153);window.adapterName="echarts-show";var Y=v.a.getThemeName();console.log("iobroker."+window.adapterName+"@"+J.a+' using theme "'+Y+'"'),window.location.host,function e(){return s.a.render(a.a.createElement(r.a,{theme:T()(Y)},a.a.createElement(U,{onThemeChange:function(t){Y=t,e()}})),document.getElementById("root"))}(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[236,1,2]]]);
//# sourceMappingURL=main.3dfcd950.chunk.js.map