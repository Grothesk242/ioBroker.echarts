(this["webpackJsonpecharts.index"]=this["webpackJsonpecharts.index"]||[]).push([[0],{250:function(e){e.exports=JSON.parse('{"a":"0.4.5"}')},425:function(e,t,o){e.exports=o(890)},430:function(e,t,o){},436:function(e,t){},438:function(e,t){},449:function(e,t){},451:function(e,t){},478:function(e,t){},480:function(e,t){},481:function(e,t){},486:function(e,t){},488:function(e,t){},507:function(e,t){},519:function(e,t){},522:function(e,t){},879:function(e){e.exports=JSON.parse('{"Save as image":"Save as image","Reset pan and zoom":"Reset pan and zoom","Save chart as svg":"Save chart as SVG","Unfortunately your browser does not support this feature":"Unfortunately your browser does not support this feature"}')},880:function(e){e.exports=JSON.parse('{"Save as image":"Als Bild speichern","Reset pan and zoom":"Verschiebung und Zoomen zur\xfccksetzen","Save chart as svg":"Diagramm als SVG speichern","Unfortunately your browser does not support this feature":"Leider unterst\xfctzt Ihr Browser diese Funktion nicht"}')},881:function(e){e.exports=JSON.parse('{"Save as image":"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435","Reset pan and zoom":"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0441\u0434\u0432\u0438\u0433 \u0438 \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435","Save chart as svg":"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a \u043a\u0430\u043a SVG","Unfortunately your browser does not support this feature":"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0432\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u044d\u0442\u0443 \u0444\u0443\u043d\u043a\u0446\u0438\u044e"}')},882:function(e){e.exports=JSON.parse('{"Save as image":"Salvar como imagem","Reset pan and zoom":"Redefinir panor\xe2mica e zoom","Save chart as svg":"Salvar gr\xe1fico como SVG","Unfortunately your browser does not support this feature":"Infelizmente, seu navegador n\xe3o oferece suporte a esse recurso"}')},883:function(e){e.exports=JSON.parse('{"Save as image":"Bewaar als afbeelding","Reset pan and zoom":"Stel pannen en zoomen opnieuw in","Save chart as svg":"Bewaar grafiek als SVG","Unfortunately your browser does not support this feature":"Helaas ondersteunt uw browser deze functie niet"}')},884:function(e){e.exports=JSON.parse('{"Save as image":"Enregistrer comme image","Reset pan and zoom":"R\xe9initialiser le panoramique et le zoom","Save chart as svg":"Enregistrer le graphique au format SVG","Unfortunately your browser does not support this feature":"Malheureusement, votre navigateur ne prend pas en charge cette fonctionnalit\xe9"}')},885:function(e){e.exports=JSON.parse('{"Save as image":"Salva come immagine","Reset pan and zoom":"Reimposta panoramica e zoom","Save chart as svg":"Salva grafico come SVG","Unfortunately your browser does not support this feature":"Purtroppo il tuo browser non supporta questa funzionalit\xe0"}')},886:function(e){e.exports=JSON.parse('{"Save as image":"Guardar como imagen","Reset pan and zoom":"Restablecer panor\xe1mica y zoom","Save chart as svg":"Guardar gr\xe1fico como SVG","Unfortunately your browser does not support this feature":"Lamentablemente, su navegador no es compatible con esta funci\xf3n."}')},887:function(e){e.exports=JSON.parse('{"Save as image":"Zapisz jako obraz","Reset pan and zoom":"Zresetuj przesuwanie i powi\u0119kszanie","Save chart as svg":"Zapisz wykres jako SVG","Unfortunately your browser does not support this feature":"Niestety Twoja przegl\u0105darka nie obs\u0142uguje tej funkcji"}')},888:function(e){e.exports=JSON.parse('{"Save as image":"\u53e6\u5b58\u4e3a\u56fe\u7247","Reset pan and zoom":"\u91cd\u7f6e\u5e73\u79fb\u548c\u7f29\u653e","Save chart as svg":"\u5c06\u56fe\u8868\u53e6\u5b58\u4e3aSVG","Unfortunately your browser does not support this feature":"\u4e0d\u5e78\u7684\u662f\uff0c\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u6b64\u529f\u80fd"}')},890:function(e,t,o){"use strict";o.r(t);var a=o(1),n=o.n(a),i=o(31),s=o.n(i),r=o(915),c=o(921),l=o(920),h=(o(430),o(74)),u=o(75),d=o(188),f=o(185),g=o(16),p=o(310),m=o(922),v=o(409),y=o.n(v),b=o(917),x=o(113),w=o.n(x),S=o(410),k=o.n(S),D=o(38),C=o.n(D),I=o(116),T=o.n(I),R=o(411),O=o.n(R),M=o(183),E=o.n(M);o(549);function z(e){e=(e||"").toString().replace(/^\?/,"");var t={};return e.split("&").forEach((function(e){if(e=e.trim()){var o=e.split("="),a=decodeURIComponent(o[0]).trim();if(o.length>1)if(t[a]=decodeURIComponent(o[1]),"true"===t[a])t[a]=!0;else if("false"===t[a])t[a]=!1;else{var n=parseFloat(t[a]);n.toString()===t[a]&&(t[a]=n)}else t[a]=!0}})),t}function F(e){if(e.lines&&(e.l=e.lines,delete e.lines),e._ids){var t=e._ids?e._ids.split(";"):[],o=e._colors?e._colors.split(";"):[],a=e._names?e._names.split(";"):[],n=e._units?e._units.split(";"):[];e.l=[];for(var i=0;i<t.length;i++)e.l.push({id:t[i],offset:0,name:a[i]||"",aggregate:"onchange",color:o[i]||"blue",thickness:e.strokeWidth||1,shadowsize:e.strokeWidth||1,min:e.min||"",max:e.max||"",unit:n[i]||""});e.aggregateType="step",e.aggregateSpan=300,e.relativeEnd="now"}if(e.l)for(var s=0;s<e.l.length;s++)e.l[s].art&&(e.l[s].aggregate=e.l[s].art,delete e.l[s].art),e.instance&&!e.l[s].instance&&(e.l[s].instance=e.instance),e.l[s].yOffset=parseFloat(e.l[s].yOffset)||0,e.l[s].offset=parseFloat(e.l[s].offset)||0,e.l[s].validTime=parseFloat(e.l[s].validTime)||0;if(e.l=e.l||[],e.m){e.marks=[];for(var r=0;r<e.m.length;r++)e.marks[r]={lineId:e.m[r].l,upperValueOrId:e.m[r].v,lowerValueOrId:e.m[r].vl,color:e.m[r].c,fill:e.m[r].f,ol:e.m[r].t,os:e.m[r].s,text:e.m[r].d,textPosition:e.m[r].p,textOffset:e.m[r].py,textColor:e.m[r].fc,textSize:e.m[r].fs};delete e.m}return e.marks=e.marks||[],e.l.length||e.l.push({id:"",unit:""}),e.width=e.width||"100%",e.height=e.height||"100%",e.timeFormat=e.timeFormat||"",e.useComma="true"===e.useComma||!0===e.useComma,e.zoom="true"===e.zoom||!0===e.zoom,e.export="true"===e.export||!0===e.export,e.grid_hideX="true"===e.grid_hideX||!0===e.grid_hideX,e.grid_hideY="true"===e.grid_hideY||!0===e.grid_hideY,e.hoverDetail="true"===e.hoverDetail||!0===e.hoverDetail,e.noLoader="true"===e.noLoader||!0===e.noLoader,e.noedit="true"===e.noedit||!0===e.noedit,e.animation=parseInt(e.animation)||0,e.afterComma=void 0===e.afterComma?2:parseInt(e.afterComma,10),e.timeType=e.timeType||"relative",e}var N="notConnectedError",L=function(){function e(t,o,a){var n=this;Object(h.a)(this,e),this.onStateChange=function(e,t){if(e&&t&&n.actualValues&&!n.reading){n.debug&&console.log("State update "+e+" - "+t.val);for(var o=!1,a=0;a<n.config.l.length;a++)if(n.config.l[a].id===e){n.actualValues[a]!==t.val&&(n.actualValues[a]=t.val,o=!0);break}o&&n.onUpdateFunc(null,n.actualValues)}},a=Object.assign({updateTimeout:300},a||{}),this.socket=t,this.updateTimeout=a.updateTimeout||300,this.serverSide=a.serverSide||!1,this.seriesData=[],this.actualValues=[],this.ticks=null,this.liveInterval=null,this.reading=!1,this.navOptions={},this.subscribes=[],this.sessionId=1,this.updateInterval=null,this.presetSubscribed=!1,this.defaultHistory="",this.onUpdateFunc=null,this.onReadingFunc=null,this.onErrorFunc=null,this.objectPromises={},this.debug=!1,this.zoomData=null,this.serverSide||(this.lastHash=window.location.hash,o||(this.onHashInstalled=!0,this.onHashChangeBound=this.onHashChange.bind(this),window.addEventListener("hashchange",this.onHashChangeBound,!1)),this.onPresetUpdateBound=this.onPresetUpdate.bind(this)),this.socket.getSystemConfig().catch((function(e){return e===N&&n.onErrorFunc&&n.onErrorFunc(e),console.error("Cannot read systemConfig: "+e),null})).then((function(e){return n.systemConfig=e&&e.common?e.common:{},n.defaultHistory=n.systemConfig.defaultHistory,n.analyseAndLoadConfig(o)}))}return Object(u.a)(e,[{key:"analyseAndLoadConfig",value:function(e){var t=this;if(e)"string"===typeof e?this.preset=e:this.config=F(e);else{var o=z(window.location.search);if(this.debug=!0===o.debug||"true"===o.debug||1===o.debug||"1"===o.debug,o.preset&&"string"===typeof o.preset)this.preset=o.preset;else{var a=z((window.location.hash||"").toString().replace(/^#/,""));if(a.data)try{a.data=JSON.parse(a.data)}catch(i){a.data={}}if(o.data)try{o.data=JSON.parse(o.data)}catch(i){o.data={}}var n=Object.assign(o.data||{},a.data||{},!0);void 0!==a.noLoader&&(n.noLoader=!0===a.noLoader||"true"===a.noLoader||1===a.noLoader||"1"===a.noLoader),void 0!==o.noLoader&&(n.noLoader=!0===o.noLoader||"true"===o.noLoader||1===o.noLoader||"1"===o.noLoader),this.config=F(n)}}this.seriesData=[],this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null),this.preset?((this.preset.startsWith("echarts.")||this.preset.startsWith("flot."))&&this.preset.includes(".")||(this.preset="echarts.0."+this.preset),this.socket.getObject(this.preset).then((function(e){if(!e||!e.native||!e.native.data||"chart"!==e.type)return console.error("[ChartModel] Invalid object ".concat(t.preset,": ").concat(JSON.stringify(e)));t.config=F(e.native.data),t.config.useComma=void 0===t.config.useComma?!0===t.systemConfig.isFloatComma||"true"===t.systemConfig.isFloatComma:"true"===t.config.useComma||!0===t.config.useComma,t.config.lang=t.systemConfig.language,t.config.live=parseInt(t.config.live,10)||0,t.config.debug=t.debug,t.readData(),t.serverSide||t.presetSubscribed===t.preset||(t.presetSubscribed&&t.socket.unsubscribeObject(t.presetSubscribed,t.onPresetUpdateBound),t.presetSubscribed=t.preset,t.socket.subscribeObject(t.preset,t.onPresetUpdateBound)),t.serverSide||!t.config.live||t.zoomData&&t.zoomData.stopLive||(t.updateInterval=setInterval((function(){return t.readData()}),1e3*t.config.live))})).catch((function(e){e===N&&t.onErrorFunc&&t.onErrorFunc(e),console.error("Cannot read ".concat(t.preset,": ").concat(e))}))):(this.config.useComma=void 0===this.config.useComma?!0===this.systemConfig.isFloatComma||"true"===this.systemConfig.isFloatComma:"true"===this.config.useComma||!0===this.config.useComma,this.config.lang=this.systemConfig.language,this.config.live=parseInt(this.config.live,10)||0,this.config.debug=this.debug,this.readData(),this.serverSide||!this.config.live||this.zoomData&&this.zoomData.stopLive||(this.updateInterval=setInterval((function(){return t.readData()}),1e3*this.config.live)))}},{key:"onHashChange",value:function(){this.lastHash!==window.location.hash&&(this.lastHash=window.location.hash,this.analyseAndLoadConfig())}},{key:"onPresetUpdate",value:function(e,t){var o=this;e===this.preset&&(this.presetUpdateTimeout&&clearTimeout(this.presetUpdateTimeout),this.presetUpdateTimeout=setTimeout((function(){var e;o.presetUpdateTimeout=null,e=F(t?t.native.data:{}),JSON.stringify(e)!==JSON.stringify(o.config)&&(o.config=e,o.updateInterval&&clearInterval(o.updateInterval),o.updateInterval=null,!o.config.live||o.zoomData&&o.zoomData.stopLive||(o.updateInterval=setInterval((function(){return o.readData()}),1e3*o.config.live)),o.readData())}),100))}},{key:"setNewRange",value:function(e){var t=this;if(this.debug&&console.log("[ChartModel] [".concat((new Date).toISOString(),"] setNewRange: ").concat(JSON.stringify(e))),e)if(e.stopLive)this.zoomData=this.zoomData||{},this.zoomData.stopLive=!0,this.updateInterval&&(console.log("Clear interval"),clearInterval(this.updateInterval),this.updateInterval=null);else{var o=this.zoomData&&this.zoomData.stopLive;o&&delete this.zoomData.stopLive,this.zoomData&&JSON.stringify(this.zoomData)===JSON.stringify(e)?o&&(this.zoomData.stopLive=!0):(this.zoomData=e,o&&(this.zoomData.stopLive=!0),this.readOnZoomTimeout&&clearTimeout(this.readOnZoomTimeout),this.readOnZoomTimeout=setTimeout((function(){t.readOnZoomTimeout=null,t.readData()}),this.updateTimeout))}else this.zoomData&&(this.zoomData=null,this.readOnZoomTimeout&&clearTimeout(this.readOnZoomTimeout),this.readOnZoomTimeout=setTimeout((function(){t.readOnZoomTimeout=null,!t.config.live||t.zoomData&&t.zoomData.stopLive||(console.log("Restore update"),t.updateInterval&&clearInterval(t.updateInterval),t.updateInterval=setInterval((function(){return t.readData()}),1e3*t.config.live)),t.readData()}),this.updateTimeout))}},{key:"destroy",value:function(){var e=this;this.subscribed&&(this.subscribes.forEach((function(t){return e.socket.unsubscribeState(t,e.onStateChange)})),this.subscribes=[],this.subscribed=null),this.readOnZoomTimeout&&(clearTimeout(this.readOnZoomTimeout),this.readOnZoomTimeout=null),this.presetUpdateTimeout&&(clearTimeout(this.presetUpdateTimeout),this.presetUpdateTimeout=null),this.presetSubscribed&&(this.socket.unsubscribeObject(this.presetSubscribed,this.onPresetUpdateBound),this.presetSubscribed=null),this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null),this.serverSide||(this.onHashInstalled&&window.removeEventListener("hashchange",this.onHashChangeBound,!1),this.onHashInstalled=!1)}},{key:"onUpdate",value:function(e){this.onUpdateFunc=e}},{key:"onReading",value:function(e){this.onReadingFunc=e}},{key:"onError",value:function(e){this.onErrorFunc=e}},{key:"getConfig",value:function(){return this.config}},{key:"getSystemConfig",value:function(){return this.systemConfig}},{key:"setConfig",value:function(e){this.analyseAndLoadConfig(e)}},{key:"getStartStop",value:function(e,t){var o,a,n,i={};if(this.config.l[e].offset=this.config.l[e].offset||0,"string"===typeof this.config.range&&this.config.range.includes("m")&&this.config.l.length>1)for(var s=parseInt(this.config.range,10)||1,r=0;r<this.config.l.length;r++)if(this.config.l[r].offset&&0!==this.config.l[r].offset){n=this.addTime(this.now,this.config.l[0].offset);var c=new Date(n);c.setMonth(c.getMonth()-s),this.config.range=Math.floor((n-c.getTime())/6e4)+"";break}if(t)return this.zoomData?(a=this.zoomData.start,o=this.zoomData.end):a=(o=this.addTime(this.now,this.config.l[e].offset))-t,i={start:a,end:o,ignoreNull:void 0===this.config.l[e].ignoreNull?this.config.ignoreNull:this.config.l[e].ignoreNull,aggregate:this.config.l[e].aggregate||this.config.aggregate||"minmax",count:1,from:!1,ack:!1,q:!1,addID:!1},this.config.start=this.addTime(o,this.config.range,!1,!0),this.config.end=o,i;if(this.zoomData)a=this.zoomData.start,o=this.zoomData.end;else if("static"===this.config.timeType){var l,h;l=void 0!==this.config.start_time?this.config.start_time.split(":").map(Number):[0,0],h=void 0!==this.config.end_time?this.config.end_time.split(":").map(Number):[24,0],a=new Date(this.config.start).setHours(l[0],l[1]),o=new Date(this.config.end).setHours(h[0],h[1]),a=this.addTime(a,this.config.l[e].offset),o=this.addTime(o,this.config.l[e].offset)}else{if(this.config.relativeEnd=this.config.relativeEnd||"now","now"===this.config.relativeEnd)n=new Date(this.now);else if(-1!==this.config.relativeEnd.indexOf("minute")){var u=parseInt(this.config.relativeEnd,10)||1;(n=new Date(this.now)).setMinutes(Math.floor(n.getMinutes()/u)*u+u),n.setSeconds(0),n.setMilliseconds(0)}else if(-1!==this.config.relativeEnd.indexOf("hour")){var d=parseInt(this.config.relativeEnd,10)||1;(n=new Date(this.now)).setHours(Math.floor(n.getHours()/d)*d+d),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0)}else"today"===this.config.relativeEnd?((n=new Date(this.now)).setDate(n.getDate()+1),n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0)):"weekUsa"===this.config.relativeEnd?((n=new Date(this.now)).setDate(n.getDate()-n.getDay()+7),n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0)):"weekEurope"===this.config.relativeEnd?(0===(n=new Date(this.now)).getDay()?n.setDate(n.getDate()+1):n.setDate(n.getDate()-n.getDay()+8),n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0)):"month"===this.config.relativeEnd?((n=new Date(this.now)).setMonth(n.getMonth()+1),n.setDate(1),n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0)):"year"===this.config.relativeEnd&&((n=new Date(this.now)).setFullYear(n.getFullYear()+1),n.setMonth(0),n.setDate(1),n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0));this.config.range=this.config.range||"30m",o=this.addTime(n,this.config.l[e].offset),a=this.addTime(o,this.config.range,!1,!0)}return i={start:a,end:o,ignoreNull:void 0===this.config.l[e].ignoreNull?this.config.ignoreNull:this.config.l[e].ignoreNull,aggregate:this.config.l[e].aggregate||this.config.aggregate||"minmax",from:!1,ack:!1,q:!1,addID:!1},"step"===this.config.aggregateType?i.step=1e3*this.config.aggregateSpan:"count"===this.config.aggregateType&&(i.count=this.config.aggregateSpan||300),this.config.start=a,this.config.end=o,i}},{key:"readOneChart",value:function(e,t,o,a){var n=this,i=this.getStartStop(o);i.instance=t,i.sessionId=this.sessionId,this.debug&&console.log("[ChartModel] "+new Date(i.start)+" - "+new Date(i.end)),this.socket.getHistoryEx(e,i).then((function(e){if(n.sessionId&&e.sessionId&&e.sessionId!==n.sessionId)return console.warn("[ChartModel] Ignore request with sessionId=".concat(e.sessionId,", actual is ").concat(n.sessionId));if(e&&e.values){i.yOffset=n.config.l[o].yOffset;var t=e.values;n.seriesData[o]=[];for(var a=n.seriesData[o],s=0;s<t.length;s++)"true"===t[s].val||!0===t[s].val?t[s].val=1:"false"!==t[s].val&&!1!==t[s].val||(t[s].val=0),"string"===typeof t[s].val&&(t[s].val=parseFloat(t[s].val)),a.push({value:[t[s].ts,null!==t[s].val?t[s].val+i.yOffset:null]});if(a.length){a[0].value[0]>i.start&&a.unshift({value:[i.start,null],exact:!1});var r=a[a.length-1];r.value[0]<i.end&&(n.config.l[o].validTime&&i.end-1e3*n.config.l[o].validTime<=r.value[0]?a.push({value:[i.end,r.value[1]],exact:!1}):a.push({value:[i.end,null],exact:!1}))}else a.push({value:[i.start,null],exact:!1}),a.push({value:[i.end,null],exact:!1});e.values=null,e=null}return Promise.resolve()})).catch((function(e){e===N&&n.onErrorFunc&&n.onErrorFunc(e),e&&console.error("[ChartModel] "+e)})).then((function(){return n.config.legActual?n.socket.getState(e).then((function(e){return n.actualValues[o]=e&&e.val||null})).catch((function(t){console.warn("Cannot read last value of ".concat(e,": ").concat(t)),n.actualValues[o]=null})).then((function(){n.subscribes.includes(e)||(n.subscribes.push(e),n.subscribed=!0,n.socket.subscribeState(e,n.onStateChange))})):Promise.resolve()})).then((function(){return a(e,o)}))}},{key:"_readObject",value:function(e){var t=this;return this.objectPromises[e]||(this.objectPromises[e]=this.socket.getObject(e).catch((function(o){return o===N&&t.onErrorFunc&&t.onErrorFunc(o),console.error("Cannot read ".concat(e,": ").concat(o)),null}))),this.objectPromises[e]}},{key:"_readOneLine",value:function(e,t){var o=this;return this._readObject(this.config.l[e].id).then((function(t){return t&&t.common&&(o.config.l[e].name=o.config.l[e].name||t.common.name,o.config.l[e].unit=o.config.l[e].unit||(t.common.unit?t.common.unit.replace("\ufffd","\xb0"):""),o.config.l[e].type=t.common.type,"auto"===o.config.l[e].chartType&&(o.config.l[e].chartType="boolean"===t.common.type?"steps":"line",o.config.l[e].aggregate="boolean"===t.common.type?"onchange":"minmax")),Promise.resolve()})).catch((function(t){return t===N&&o.onErrorFunc&&o.onErrorFunc(t),console.error("[ChartModel] Cannot read object ".concat(o.config.l[e].id,": ").concat(t)),Promise.resolve()})).then((function(){o.config.l[e].name=o.config.l[e].name||o.config.l[e].id,o.config.l[e].unit=o.config.l[e].unit||"","auto"===o.config.l[e].chartType&&(o.config.l[e].chartType="line",o.config.l[e].aggregate="minmax"),"object"===typeof o.config.l[e].name&&(o.config.l[e].name=o.config.l[e].name[o.systemConfig.language]||o.config.l[e].name.en),o.readOneChart(o.config.l[e].id,o.config.l[e].instance||o.defaultHistory,e,t)}))}},{key:"_readData",value:function(e,t){var o=this;if((t=t||0)>=this.config.l.length)return e();""!==this.config.l[t]&&void 0!==this.config.l[t]&&this.seriesData.push([]),this._readOneLine(t,(function(){return setTimeout((function(){return o._readData(e,t+1)}),10)}))}},{key:"readTicks",value:function(e){var t=this;if(this.config.ticks){var o=JSON.parse(JSON.stringify(this.getStartStop(0)));o.instance=this.config.l[0].instance||this.defaultHistory,o.sessionId=this.sessionId,o.aggregate="onchange",this.debug&&console.log("[ChartModel] Ticks: "+new Date(o.start)+" - "+new Date(o.end)),this.socket.getHistoryEx(this.config.ticks,o).then((function(e){if(t.sessionId&&e.sessionId&&e.sessionId!==t.sessionId)return console.warn("[ChartModel] Ignore request with sessionId=".concat(e.sessionId,", actual is ").concat(t.sessionId));if(e&&e.values){var a=t.ticks||[];t.ticks&&t.ticks.length&&t.ticks.splice(0,t.ticks.length);for(var n=e.values,i=0;i<n.length;i++)null!==n[i].val&&a.push({value:[n[i].ts,n[i].val]});a.length?(a[0][0]>o.start&&a.unshift({value:[o.start,""]}),a[a.length-1][0]<o.end&&a.push({value:[o.end,""]})):(a.push({value:[o.start,""]}),a.push({value:[o.end,""]})),e.values=null,e=null,t.ticks=a}return Promise.resolve()})).catch((function(e){e===N&&t.onErrorFunc&&t.onErrorFunc(e),console.error("[ChartModel] ".concat(e))})).then((function(){return e&&e(t.ticks)}))}else e(null)}},{key:"readValue",value:function(e,t,o){var a=this;this.socket.getState(e).then((function(e){o(t,e&&parseFloat(e.val)||0)})).catch((function(e){e===N&&a.onErrorFunc&&a.onErrorFunc(e),console.error("[ChartModel] ".concat(e)),o(t,0)}))}},{key:"readMarkings",value:function(e,t){var o=this;return t=t||0,!this.config.marks||!this.config.marks.length||t>=this.config.marks.length?e():new Promise((function(e){(o.config.marks[t].upperValueOrId||0===o.config.marks[t].upperValueOrId)&&parseFloat(o.config.marks[t].upperValueOrId).toString()!==o.config.marks[t].upperValueOrId.toString().replace(/\.0*$/,"")&&o.config.marks[t].upperValueOrId.toString().includes(".")?o.socket.getState(o.config.marks[t].upperValueOrId).then((function(a){a&&void 0!==a.val&&null!==a.val?o.config.marks[t].upperValue=parseFloat(a.val)||0:o.config.marks[t].upperValue=null,e()})).catch((function(a){a===N&&o.onErrorFunc&&o.onErrorFunc(a),console.error("Cannot read marking ".concat(o.config.marks[t].upperValueOrId,": ").concat(a)),e()})):e()})).then((function(){return new Promise((function(e){(o.config.marks[t].lowerValueOrId||0===o.config.marks[t].lowerValueOrId)&&parseFloat(o.config.marks[t].lowerValueOrId).toString()!==o.config.marks[t].lowerValueOrId.replace(/\.0*$/,"")&&o.config.marks[t].lowerValueOrId.includes(".")?o.socket.getState(o.config.marks[t].lowerValueOrId).then((function(a){a&&void 0!==a.val&&null!==a.val?o.config.marks[t].lowerValue=parseFloat(a.val)||0:o.config.marks[t].lowerValue=null,e()})).catch((function(a){a===N&&o.onErrorFunc&&o.onErrorFunc(a),console.error("Cannot read marking ".concat(o.config.marks[t].lowerValueOrId,": ").concat(a)),e()})):e()}))})).then((function(){return setTimeout((function(){return o.readMarkings(e,t+1)}),0)}))}},{key:"subscribeAll",value:function(e,t,o){var a=this;o=o||0,!e||!e.length||o>=e.length?t():(this.socket.subscribeState(e[o],this.onStateChange),setTimeout((function(){return a.subscribeAll(e,t,o+1)}),0))}},{key:"addTime",value:function(e,t,o,a){return e=new Date(e),"string"===typeof t?"m"===t[1]?(t=parseInt(t,10),e.setMonth(o?e.getMonth()+t:e.getMonth()-t),e=e.getTime()):"y"===t[1]?(t=parseInt(t,10),e.setFullYear(o?e.getFullYear()+t:e.getFullYear()-t),e=e.getTime()):(e=e.getTime(),a?o?e+=6e4*(parseInt(t,10)||0):e-=6e4*(parseInt(t,10)||0):o?e+=1e3*(parseInt(t,10)||0):e-=1e3*(parseInt(t,10)||0)):(e=e.getTime(),a?o?e+=6e4*(parseInt(t,10)||0):e-=6e4*(parseInt(t,10)||0):o?e+=1e3*(parseInt(t,10)||0):e-=1e3*(parseInt(t,10)||0)),e}},{key:"readData",value:function(){var e=this;this.readOnZoomTimeout&&(clearTimeout(this.readOnZoomTimeout),this.readOnZoomTimeout=null),this.now=Date.now(),console.log("Read till "+new Date(this.now)),this.sessionId=this.sessionId||0,this.sessionId++,this.sessionId>16777215&&(this.sessionId=1),this.config.l?(this.reading=!0,this.onReadingFunc&&this.onReadingFunc(!0),this.seriesData=[],this._readData((function(){return e.readTicks((function(t){return e.readMarkings((function(){e.reading=!1,e.onUpdateFunc(e.seriesData,e.actualValues)}))}))}))):(this.onErrorFunc&&this.onErrorFunc("No config provided"),this.onReadingFunc&&this.onReadingFunc(!1),this.reading=!1)}}]),e}(),_=o(918),A=o(186),V=o(41),B=o.n(V),H=(o(550),o(551),o(552),o(553),o(554),o(555),o(556),o(557),o(558),o(559),o(412)),U=o.n(H),j=o(4),P=o.n(j),J=(o(348),o(355),o(356),o(360),o(361),o(362),{azul:["#f2385a","#f5a503","#4ad9d9","#f7879c","#c1d7a8","#4dffd2","#fccfd7","#d5f6f6"],"bee-inspired":["#001727","#805500","#ffff00","#ffd11a","#f2d71f","#f2be19","#f3a81a","#fff5cc"],blue:["#1790cf","#1bb2d8","#99d2dd","#88b0bb","#1c7099","#038cc4","#75abd0","#afd6dd"],infographic:["#C1232B","#27727B","#FCCE10","#E87C25","#B5C334","#FE8463","#9BCA63","#FAD860","#F3A43B","#60C0DD","#D7504B","#C6E579","#F4E001","#F0805A","#26C0C0"],vintage:["#d87c7c","#919e8b","#d7ab82","#6e7074","#61a0a8","#efa18d","#787464","#cc7e63","#724e58","#4b565b"],dark:["#dd6b66","#759aa0","#e69d87","#8dc1a9","#ea7e53","#eedd78","#73a373","#73b9bc","#7289ab","#91ca8c","#f49f42"],macarons:["#2ec7c9","#b6a2de","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],shine:["#c12e34","#e6b600","#0098d9","#2b821d","#005eaa","#339ca8","#cda819","#32a487"],roma:["#E01F54","#001852","#f5e8c8","#b8d2c7","#c6b38e","#a4d8c2","#f3d999","#d3758f","#dcc392","#2e4783","#82b6e9","#ff6347","#a092f1","#0a915d","#eaf889","#6699FF","#ff6666","#3cb371","#d5b158","#38b6b6"],royal:["#3f7ea6","#993366","#408000","#8c6f56","#a65149","#731f17","#adc2eb","#d9c3b0"],"dark-blue":["#00305a","#004b8d","#0074d9","#4192d9","#7abaf2","#99cce6","#d6ebf5","#eeeeee"],"tech-blue":["#4d4d4d","#3a5897","#007bb6","#7094db","#0080ff","#b3b3ff","#00bdec","#33ccff","#ccddff","#eeeeee"],red:["#d8361b","#f16b4c","#f7b4a9","#d26666","#99311c","#c42703","#d07e75"],"red-velvet":["#8b1a2d","#a7314b","#e6004c","#ff8066","#8e5c4e","#ff1a66","#d6c582","#f0d4af"],green:["#408829","#68a54a","#a9cba2","#86b379","#397b29","#8abb6f","#759c6a","#bfd3b7"],light:["#37A2DA","#32C5E9","#67E0E3","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#E062AE","#E690D1","#e7bcf3","#9d96f5","#8378EA","#96BFFF"],gray:["#757575","#c7c7c7","#dadada","#8b8b8b","#b5b5b5","#e9e9e9"],"dark-bold":["#458c6b","#f2da87","#d9a86c","#d94436","#a62424","#76bc9b","#cce6da","#eeeeee"]});function W(e){return(e=(e||"").toString()).length<2?"0"+e:e}var X=function(){function e(t,o,a,n){if(Object(h.a)(this,e),this.moment=t,!this.moment)throw new Error("moment must be set and initialized");this.config=n?JSON.parse(JSON.stringify(n)):null,this.calcTextWidth=a,this.themeType=o||"light",this.chart={yAxis:[]}}return Object(u.a)(e,[{key:"setThemeName",value:function(e){this.themeType=e||"light"}},{key:"setConfig",value:function(e){this.config=e}},{key:"getHelperChartData",value:function(){return this.chart}},{key:"convertData",value:function(e,t,o){var a=e[t];if(!a||!a.length)return[];var n=this.chart.yAxis[o]||{max:null,min:null};this.chart.yAxis[o]=n;for(var i=0;i<a.length;i++)null!==a[i].value[1]&&((null===n.min||n.min>a[i].value[1])&&(n.min=a[i].value[1]),(null===n.max||n.max<a[i].value[1])&&(n.max=a[i].value[1]));return(null===this.chart.xMin||this.chart.xMin>a[0].value[0])&&(this.chart.xMin=a[0].value[0]),(null===this.chart.xMax||this.chart.xMax<a[a.length-1].value[0])&&(this.chart.xMax=a[a.length-1].value[0]),a}},{key:"getSeries",value:function(e,t){var o=this;this.chart.xMin=null,this.chart.xMax=null;var a=0;return this.config.l.map((function(n,i){var s=n.color||(J[t]?J[t][a%J[t].length]:"");n.color||a++,n.shadowsize=parseFloat(n.shadowsize)||0;var r=""===n.commonYAxis||void 0===n.commonYAxis?i:parseInt(n.commonYAxis)||0,c={name:n.name,clip:!0,xAxisIndex:0,yAxisIndex:r,type:"scatterplot"===n.chartType?"scatter":"line",showSymbol:"scatterplot"===n.chartType||n.points,hoverAnimation:!0,animation:!1,step:"steps"===n.chartType?"end":void 0,smooth:"spline"===n.chartType,data:o.convertData(e,i,r),itemStyle:{color:s},symbolSize:"scatterplot"===n.chartType||n.points?n.symbolSize||3:void 0,symbol:"circle",lineStyle:{width:parseFloat(n.thickness)||1,shadowBlur:n.shadowsize?n.shadowsize+1:0,shadowOffsetY:n.shadowsize?n.shadowsize+1:0,shadowColor:s,type:n.dashes?"dashed":n.lineStyle||"solid"}};return parseFloat(n.fill)&&(c.areaStyle={color:s,opacity:parseFloat(n.fill)||0}),c}))}},{key:"getXAxis",value:function(){return[{type:"time",splitLine:{show:!this.config.grid_hideX,lineStyle:"off"===this.config.l[0].xaxe?{color:"rgba(0,0,0,0)",type:"dashed"}:this.config.grid_color?{color:this.config.grid_color,type:"dashed"}:{type:"dashed"}},splitNumber:parseInt(this.config.l[0].xticks,10)||void 0,position:"top"===this.config.l[0].xaxe?"top":"bottom",min:this.chart.xMin,max:this.chart.xMax,axisTick:{alignWithLabel:!0,lineStyle:"off"===this.config.l[0].xaxe?{color:"rgba(0,0,0,0)"}:this.config.x_ticks_color?{color:this.config.x_ticks_color}:void 0},axisLabel:{formatter:this.xFormatter.bind(this),color:"off"===this.config.l[0].xaxe?"rgba(0,0,0,0)":this.config.x_labels_color||void 0}}]}},{key:"getYAxis",value:function(e,t){var o=this;return this.config.l.map((function(e,a){if(!e||""!==e.commonYAxis&&void 0!==e.commonYAxis)return{};var n=parseFloat(e.min),i=parseFloat(e.max),s=o.chart.yAxis;if(s[a]){var r=s[a].max-s[a].min;isNaN(n)&&(n=s[a].min-.1*r,r>25e3?n=1e4*Math.floor(n/1e4):r>5e3?n=1e3*Math.floor(n/1e3):r>200?n=100*Math.floor(n/100):r>30?n=10*Math.floor(n/10):r>10?n=Math.floor(n):r>1&&(n=Math.floor(10*n)/10)),isNaN(i)&&(i=s[a].max+.1*r,r>25e3?i=1e4*Math.ceil(i/1e4):r>5e3?i=1e3*Math.ceil(i/1e3):r>200?i=100*Math.ceil(i/100):r>30?i=10*Math.ceil(i/10):r>10?i=Math.ceil(i):r>1&&(i=Math.floor(10*i)/10))}else isNaN(n)&&(n=void 0),isNaN(i)&&(i=void 0);var c="off"===e.yaxe?"rgba(0,0,0,0)":o.config.grid_color||void 0;return"leftColor"!==e.yaxe&&"rightColor"!==e.yaxe||(c=t[a].itemStyle.color),{type:"value",min:n,max:i,position:"left"===e.yaxe||"off"===e.yaxe||"leftColor"===e.yaxe?"left":"right"===e.yaxe||"rightColor"===e.yaxe||a?"right":"left",splitLine:a?void 0:{show:!o.config.grid_hideY,lineStyle:{color:c||void 0,type:"dashed"}},splitNumber:parseInt(e.yticks,10)||void 0,axisLabel:{formatter:function(e){return o.yFormatter(e,a,!0)},color:"off"===e.yaxe||"leftColor"===e.yaxe||"rightColor"===e.yaxe?c:o.config.y_labels_color||void 0},axisTick:{alignWithLabel:!0,lineStyle:c?{color:c}:o.config.y_ticks_color?{color:o.config.y_ticks_color}:void 0}}}))}},{key:"getMarkings",value:function(e){var t=this;return this.config.marks&&this.config.marks.forEach((function(o){if(o){var a=void 0!==o.lowerValue?o.lowerValue:parseFloat(o.lowerValueOrId),n=void 0!==o.upperValue?o.upperValue:parseFloat(o.upperValueOrId),i=null!==a&&!isNaN(a),s=null!==n&&!isNaN(n),r=e.series[o.lineId];if(r){if(i&&s&&(r.markArea=r.markArea||{symbol:["none","none"],itemStyle:{color:o.color||r.itemStyle.color,borderWidth:0,opacity:parseFloat(o.fill)||0},data:[]},r.markArea.data.push([{yAxis:a,name:o.text||""},{yAxis:n}])),i||s)for(var c=0;c<2;c++)if((c||s)&&(!c||i)){var l=c?a:n;if(r.markLine=r.markLine||{symbol:["none","none"],data:[]},r.markLine.data.push({yAxis:l,name:o.text,lineStyle:{color:o.color||r.itemStyle.color,width:parseFloat(o.ol)||1,shadowBlur:parseFloat(o.os)?parseFloat(o.os)+1:0,shadowOffsetY:parseFloat(o.os)?parseFloat(o.os)+1:0,shadowColor:o.color,type:o.lineStyle||"solid"},label:{show:!!o.text,formatter:function(e){return e.name},position:"r"===o.textPosition?"end":"start",distance:-1*o.textOffset||-35,textStyle:{color:o.textColor||"#FFF",fontStyle:"normal",fontSize:o.textSize||void 0}}}),t.config.l[o.lineId]){var h=parseFloat(t.config.l[o.lineId].min);isNaN(h)&&t.chart.yAxis[o.lineId]&&t.chart.yAxis[o.lineId].min>l&&l<0&&(e.yAxis[0].min=l);var u=parseFloat(t.config.l[o.lineId].min);isNaN(u)&&t.chart.yAxis[o.lineId]&&t.chart.yAxis[o.lineId].max<l&&(e.yAxis[0].max=l)}}}else console.error("Mark line has no chart line")}})),e}},{key:"yFormatter",value:function(e,t,o,a){if("boolean"===this.config.l[t].type)return e?"TRUE":"FALSE";if(null===e||void 0===e)return"";var n=this.config.l[t].afterComma;return void 0!==n&&null!==n?(e=parseFloat(e),this.config.useComma?e.toFixed(n).replace(".",",")+(o?this.config.l[t].unit:""):e.toFixed(n)+(o?this.config.l[t].unit:"")):(a&&(e=Math.round(1e4*e)/1e4),this.config.useComma?(e=parseFloat(e)||0).toString().replace(".",",")+(o?this.config.l[t].unit:""):e.toString()+(o?this.config.l[t].unit:""))}},{key:"isXLabelHasBreak",value:function(){return this.config.timeFormat?this.config.timeFormat.replace("<br/>","\n").includes("\n"):!this.chart.withSeconds&&(this.chart.withTime,!0)}},{key:"xFormatter",value:function(e,t){var o=new Date(e);return this.config.timeFormat?this.moment(o).format(this.config.timeFormat).replace("<br/>","\n"):this.chart.withSeconds?W(o.getHours())+":"+W(o.getMinutes())+":"+W(o.getSeconds()):this.chart.withTime?W(o.getHours())+":"+W(o.getMinutes())+"\n"+W(o.getDate())+"."+W(o.getMonth()+1):W(o.getDate())+"."+W(o.getMonth()+1)+"\n"+o.getFullYear()}},{key:"getInterpolatedValue",value:function(e,t,o,a){var n=this.option.series[e].data;if(!n||!n[0]||n[0].value[0]>t||n[n.length-1].value[0]<t)return null;for(var i=0;i<n.length-1;i++){if(n[i].value[0]===t)return{exact:!0,val:n[i].value[1]};if(n[i].value[0]<t&&t<n[i+1].value[0]){var s=n[i].value[1],r=n[i+1].value[1];if(null===r||void 0===r||null===s||void 0===s)return a?null:{exact:!1,val:null};if("boolean"===o)return{exact:!1,val:s};var c=n[i+1].value[0]-n[i].value[0];return{exact:!1,val:(1-(n[i+1].value[0]-t)/c)*(r-s)+s}}}return a?null:{exact:!1,val:null}}},{key:"renderTooltip",value:function(e){var t=this,o=e[0].value[0],a=new Date(o),n=!0===this.config.hoverNoNulls||"true"===this.config.hoverNoNulls,i=this.option.series.map((function(a,i){var s,r=e.find((function(e){return e.seriesIndex===i}));if(r&&(s={exact:void 0===r.data.exact||r.data.exact,val:r.value[1]}),!(s=s||t.getInterpolatedValue(i,o,t.config.l[i].type,n)))return"";var c=null===s.val?"null":t.yFormatter(s.val,i,!1,!s.exact);return'<div style="width: 100%; display: inline-flex; justify-content: space-around; color: '.concat(a.itemStyle.color,'">')+'<div style="display: flex;margin-right: 4px">'.concat(a.name,":</div>")+'<div style="display: flex; flex-grow: 1"></div>'+'<div style="display: flex;">'.concat(s.exact?"":"i ","<b>").concat(c,"</b>").concat(null!==s.val?t.config.l[i].unit:"","</div>")+"</div>"})),s=this.config.timeFormat||"dd, MM Do YYYY, h:mm:ss.SSS";return"<b>".concat(this.moment(a).format(s),"</b><br/>").concat(i.filter((function(e){return e})).join("<br/>"))}},{key:"getLegend",value:function(e,t){var o=this;return this.config.legend&&"none"!==this.config.legend?{data:this.config.l.map((function(e){return e.name})),show:!0,left:"nw"===this.config.legend||"sw"===this.config.legend?this.chart.padLeft+1:void 0,right:"ne"===this.config.legend||"se"===this.config.legend?this.chart.padRight+1:void 0,top:"nw"===this.config.legend||"ne"===this.config.legend?10:void 0,bottom:"sw"===this.config.legend||"se"===this.config.legend?e+20:void 0,backgroundColor:this.config.legBg||void 0,formatter:function(e,a){if(o.config.legActual&&t)for(var n=0;n<o.config.l.length;n++)if(o.config.l[n].name===e)return"".concat(e," [").concat(o.yFormatter(t[n],n,!0),"]");return e},textStyle:{color:this.config.legColor||("light"===this.themeType?"#000":"#FFF")}}:void 0}},{key:"getTitle",value:function(e){if(this.config.title){var t={};return(this.config.titlePos||"top:35;left:65").split(";").forEach((function(e){var o=e.split(":");t[o[0].trim()]=parseInt(o[1].trim(),10)})),{text:this.config.title,textStyle:{fontSize:this.config.titleSize?parseInt(this.config.titleSize,10):20,color:this.config.titleColor||("light"===this.themeType?"#000":"#FFF")},textVerticalAlign:t.bottom?"bottom":"top",textAlign:50===t.left?"center":-5===t.right?"right":"left",top:35===t.top?5:50===t.top?"50%":void 0,left:50===t.left?"50%":65===t.left?this.chart.padLeft:void 0,bottom:t.bottom?t.bottom>0?t.bottom+e-10:t.bottom:void 0,right:5===t.right?this.chart.padRight:void 0}}}},{key:"getOption",value:function(e,t,o){var a=this;t&&(this.config=JSON.parse(JSON.stringify(t)));var n=this.config.theme;n&&"default"!==n||(n="light"===this.themeType?"roma":"dark-bold"),this.debug=this.config&&this.config.debug,this.debug&&console.log("[ChartView ] [".concat((new Date).toISOString(),"] ").concat(JSON.stringify(this.config,null,2)));var i=this.getSeries(e,n);this.config.start&&(this.chart.xMax<this.config.end&&(this.chart.xMax=this.config.end),this.chart.xMin>this.config.start&&(this.chart.xMin=this.config.start)),this.chart.diff=this.chart.xMax-this.chart.xMin,this.chart.withTime=this.chart.diff<6048e5,this.chart.withSeconds=this.chart.diff<18e5;var s=this.getYAxis(n,i),r=this.getXAxis(),c={theme:n,backgroundColor:"transparent",animation:!this.config.noAnimation&&!this.config.noLoader,grid:{backgroundColor:this.config.bg_custom||"transparent",show:!!this.config.bg_custom,left:0,top:8,right:0,bottom:this.isXLabelHasBreak()?40:24},tooltip:this.config.hoverDetail?{trigger:"axis",formatter:function(e){return a.renderTooltip(e)},hoverAnimation:!0,axisPointer:{animation:!0}}:void 0,xAxis:r,yAxis:s,series:i};this.getMarkings(c);var l=0,h=0;return i.forEach((function(e,t){var o=c.yAxis[e.yAxisIndex];if(!o){var n=a.config.l[e.yAxisIndex]?a.config.l[e.yAxisIndex].commonYAxis:void 0;if(void 0===n)return void console.log("Cannot find Y axis for line "+t);o=c.yAxis[n]}var i=a.yFormatter(o.min,t,!0),s=a.yFormatter(o.min||o.max!==o.min?o.max:.8,t,!0),r=o.position;if(!("off"===r||o.axisLabel&&"rgba(0,0,0,0)"===o.axisLabel.color)){var u=a.calcTextWidth(i)+4,d=a.calcTextWidth(s)+4;"left"===r||"leftColor"===r?(u>l&&(l=u),d>l&&(l=d)):(u>h&&(h=u),d>h&&(h=d))}})),c.grid.left=l+10,c.grid.right=h+10+(!0===this.config.export||"true"===this.config.export?20:0),this.chart.padLeft=c.grid.left,this.chart.padRight=c.grid.right,c.legend=this.getLegend(20,o),c.title=this.getTitle(20),this.config.grid_color||(c.yAxis.forEach((function(e){return e.splitLine&&delete e.splitLine.lineStyle})),c.xAxis.forEach((function(e){return e.splitLine&&delete e.splitLine.lineStyle}))),this.option=c,this.option}}]),e}(),Y=(o(639),o(853),o(854),o(855),o(856),o(857),o(858),o(859),o(860),o(861),o(862),o(863),o(864),o(865),o(866),o(867),o(868),o(384),o(389),o(245),o(393),o(390),null);function Z(e,t,o){var a=(Y||(Y=document.createElement("canvas"))).getContext("2d");a.font="".concat(t||12,"px ").concat(o||"Microsoft YaHei");var n=a.measureText(e);return Math.ceil(n.width)}var G=function(e){Object(d.a)(o,e);var t=Object(f.a)(o);function o(e){var a;return Object(h.a)(this,o),(a=t.call(this,e)).updateProperties=function(e){if(a.updatePropertiesTimeout=null,a.echartsReact&&"function"===typeof a.echartsReact.getEchartsInstance){var t=a.echartsReact.getEchartsInstance(),o=e.config&&e.config.l&&e.config.l.map((function(e){return e.id}))||[];o.sort();var n=JSON.stringify(o)!==JSON.stringify(a.lastIds);n&&(a.lastIds=o,t.clear()),a.option=a.chartOption.getOption(e.data,e.config,e.actualValues),a.debug&&console.log("[ChartView ] [".concat((new Date).toISOString(),"] updateProperties: {min: ").concat(a.option.xAxis[0].min,", ").concat(a.option.xAxis[0].max,"}"));try{t.setOption(a.option,n)}catch(i){console.error("Cannot apply options: "+JSON.stringify(a.option))}}},a.onResize=function(){a.timerResize&&clearTimeout(a.timerResize),a.timerResize=setTimeout((function(){a.timerResize=null,a.componentDidUpdate()}))},a.onMouseMove=function(e){if(a.mouseDown){a.divResetButton.current&&"block"!==a.divResetButton.current.style.display&&(a.divResetButton.current.style.display="block");var t=a.chartOption.getHelperChartData(),o=t.lastX-(e.offsetX-t.padLeft);t.lastX=e.offsetX-t.padLeft;var n=t.xMax-t.xMin,i=a.state.chartWidth-t.padRight-t.padLeft,s=Math.round(o*n/i);t.xMin+=s,t.xMax+=s,a.setNewRange()}},a.onMouseDown=function(e){a.mouseDown=!0,a.chartOption.getHelperChartData().lastX=e.offsetX,a.zr&&!a.zr._mousemove&&(a.zr._mousemove=!0,a.zr.on("mousemove",a.onMouseMove)),a.props.config.live&&a.props.onRangeChange&&(console.log("Stop update"),a.props.onRangeChange({stopLive:!0}))},a.onMouseUp=function(){a.mouseDown=!1,a.setNewRange(!0),a.zr&&a.zr._mousemove&&(a.zr._mousemove=!1,a.zr.off("mousemove",a.onMouseMove))},a.onMouseWheel=function(e){var t=a.chartOption.getHelperChartData(),o=t.xMax-t.xMin,n=a.state.chartWidth-t.padRight-t.padLeft,i=(e.offsetX-t.padLeft)/n,s=o-(o*=e.wheelDelta>0?1.1:.9);t.xMax+=s*(1-i),t.xMin-=s*i,a.setNewRange(),a.updateDataTimer&&clearTimeout(a.updateDataTimer),a.updateDataTimer=setTimeout((function(){return a.setNewRange(!0)}),1e3)},a.onTouchStart=function(e){e.preventDefault(),a.mouseDown=!0;var t=e.touches||e.originalEvent.touches;if(t){var o=a.chartOption.getHelperChartData();o.lastX=t[t.length-1].pageX,t.length>1?o.lastWidth=Math.abs(t[0].pageX-t[1].pageX):o.lastWidth=null}},a.onTouchEnd=function(e){e.preventDefault(),a.mouseDown=!1,a.setNewRange(!0)},a.onTouchMove=function(e){e.preventDefault();var t=e.touches||e.originalEvent.touches;if(t){var o=a.chartOption.getHelperChartData(),n=t[t.length-1].pageX-o.padLeft;if(a.mouseDown)if(t.length>1){var i=Math.abs(t[0].pageX-t[1].pageX);if(null!==o.lastWidth&&i!==o.lastWidth){var s=o.xMax-o.xMin,r=a.state.chartWidth-o.padRight-o.padLeft,c=i>o.lastWidth?1.1:.9,l=(t[0].pageX>t[1].pageX?t[1].pageX-o.padLeft+i/2:t[0].pageX-o.padLeft+i/2)/r,h=s-(s*=c);o.xMax+=h*(1-l),o.xMin-=h*l,a.setNewRange()}o.lastWidth=i}else{var u=o.lastX-n,d=o.xMax-o.xMin,f=a.state.chartWidth-o.padRight-o.padLeft,g=Math.round(u*d/f);o.xMin+=g,o.xMax+=g,a.setNewRange()}o.lastX=n}},a.state={chartHeight:null,chartWidth:null},a.echartsReact=n.a.createRef(),a.divRef=n.a.createRef(),a.divResetButton=n.a.createRef(),B.a.locale(C.a.getLanguage()),a.lastIds=a.props.config&&a.props.config.l&&a.props.config.l.map((function(e){return e.id}))||[],a.lastIds.sort(),a.chartOption=new X(B.a,a.props.themeType,Z),a}return Object(u.a)(o,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){if(e.data===this.state.data)return null;this.updatePropertiesTimeout&&clearTimeout(this.updatePropertiesTimeout),this.updatePropertiesTimeout=setTimeout(this.updateProperties,100,e)}},{key:"setNewRange",value:function(e){var t=this.chartOption.getHelperChartData();if(t.diff=t.xMax-t.xMin,t.withTime=t.diff<6048e5,t.withSeconds=t.diff<18e5,console.log("[ChartView ] [".concat((new Date).toISOString(),"] setNewRange: ").concat(!!e,", {min: ").concat(t.xMin,", max: ").concat(t.xMax,"}")),e)this.updateDataTimer&&clearTimeout(this.updateDataTimer),this.updateDataTimer=null,this.props.onRangeChange&&this.props.onRangeChange({start:t.xMin,end:t.xMax});else{console.log("[ChartView ] [".concat((new Date).toISOString(),"] setOption in setNewRange")),this.option.xAxis[0].min=t.xMin,this.option.xAxis[0].max=t.xMax;try{this.echartsReact&&"function"===typeof this.echartsReact.getEchartsInstance&&this.echartsReact.getEchartsInstance().setOption({xAxis:{min:t.xMin,max:t.xMax}})}catch(o){console.error("Cannot apply options 1: "+JSON.stringify(this.option))}}}},{key:"installEventHandlers",value:function(){this.zr=this.echartsReact&&this.echartsReact.getEchartsInstance&&this.echartsReact.getEchartsInstance().getZr(),this.zr&&this.props.config.zoom&&!this.zr._iobInstalled?(this.zr._iobInstalled=!0,this.zr.on("mousedown",this.onMouseDown),this.zr.on("mouseup",this.onMouseUp),this.zr.on("mousewheel",this.onMouseWheel),this.zr.on("touchstart",this.onTouchStart),this.zr.on("touchend",this.onTouchEnd),this.zr.on("touchmove",this.onTouchMove)):this.zr&&!this.props.config.zoom&&this.zr._iobInstalled&&(this.zr._iobInstalled=!1,this.zr.off("mousedown",this.onMouseDown),this.zr.off("mouseup",this.onMouseUp),this.zr.off("mousewheel",this.onMouseWheel),this.zr&&this.zr._mousemove&&(this.zr._mousemove=!1,this.zr.off("mousemove",this.onMouseMove)),this.zr.off("touchstart",this.onTouchStart),this.zr.off("touchend",this.onTouchEnd),this.zr.off("touchmove",this.onTouchMove))}},{key:"renderChart",value:function(){var e=this;return this.props.data?(this.option=this.option||this.chartOption.getOption(this.props.data,this.props.config,this.props.actualValues),this.debug&&console.log("[ChartView ] [".concat((new Date).toISOString(),"] render chart")),n.a.createElement(U.a,{ref:function(t){return e.echartsReact=t},echarts:P.a,option:this.option,notMerge:!0,lazyUpdate:!0,theme:this.option.theme,style:{height:this.state.chartHeight+"px",width:"100%"},opts:{renderer:"svg"},onEvents:{rendered:function(t){e.props.config.zoom&&e.installEventHandlers()}}})):n.a.createElement(b.a,null)}},{key:"componentDidUpdate",value:function(){var e=this;if(this.divRef.current){var t="noborder"!==this.props.config.noBorder&&parseFloat(this.props.config.border_width)||0,o=parseFloat(this.props.config.border_padding)||0,a=this.divRef.current.offsetHeight-2*(t+o);if(this.state.chartHeight!==a){var n=this.divRef.current.offsetWidth-2*(t+o);setTimeout((function(){return e.setState({chartHeight:a,chartWidth:n})}),10)}}}},{key:"renderResetButton",value:function(){var e=this;return n.a.createElement(_.a,{ref:this.divResetButton,size:"small",color:"default",style:{display:"none"},className:this.props.classes.resetButton,title:C.a.t("Reset pan and zoom"),onClick:function(){e.divResetButton.current&&(e.divResetButton.current.style.display="none"),e.props.onRangeChange&&e.props.onRangeChange()}},n.a.createElement(A.b,{className:this.props.classes.resetButtonIcon}))}},{key:"renderExportButton",value:function(){var e=this;return this.props.config.export?n.a.createElement(A.a,{color:this.props.config.exportColor||"default",className:this.props.classes.exportButton,title:C.a.t("Save chart as svg"),onClick:function(){if(e.echartsReact&&"function"===typeof e.echartsReact.getEchartsInstance){var t=e.echartsReact.getEchartsInstance().getDataURL({pixelRatio:2,backgroundColor:e.props.config.window_bg||("dark"===e.props.themeType?"#000":"#FFF")}),o=document.createElement("a");document.body.appendChild(o),o.href=t,o.target="_self";var a="";a=1===e.props.config.l.length?e.props.config.l[0].name:"chart";var n=e.option,i=new Date(n.xAxis[0].max||n.series[0].data[n.series[0].data.length-1].value[0]);try{o.download="".concat(i.getFullYear(),"_").concat((i.getMonth()+1).toString().padStart(2,"0"),"_").concat(i.getDate().toString().padStart(2,"0"))+"_".concat(i.getHours().toString().padStart(2,"0"),"_").concat(i.getMinutes().toString().padStart(2,"0"),"_").concat(a,".svg"),o.click()}catch(s){console.error("Cannot access download: ".concat(s)),window.alert(C.a.t("Unfortunately your browser does not support this feature"))}}}}):null}},{key:"render",value:function(){var e=this;this.divRef.current||setTimeout((function(){return e.forceUpdate()}),10);var t="noborder"!==this.props.config.noBorder&&parseFloat(this.props.config.border_width)||0,o=parseFloat(this.props.config.border_padding)||0;return n.a.createElement("div",{ref:this.divRef,className:this.props.classes.chart,style:{borderWidth:t,width:t||o?"calc(100% - "+(2*(t+o)+1)+"px":void 0,height:t||o?"calc(100% - "+2*(t+o)+"px":void 0,background:this.props.config.noBackground?void 0:this.props.config.window_bg||void 0,borderColor:"noborder"!==this.props.config.noBorder&&this.props.config.border_color||void 0,borderStyle:"noborder"!==this.props.config.noBorder&&t?this.props.config.border_style||"solid":"hidden",padding:o||0}},this.renderExportButton(),this.renderResetButton(),null!==this.state.chartHeight?this.renderChart():null)}}]),o}(n.a.Component),q=Object(m.a)()(Object(g.a)((function(e){return{chart:{maxHeight:"100%",maxWidth:"100%",width:"100%",height:"100%",overflow:"hidden",position:"relative"},exportButton:{position:"absolute",top:40,right:5,width:20,height:20,zIndex:2,opacity:.7,cursor:"pointer"},resetButton:{position:"absolute",top:10,right:25,zIndex:2,opacity:.7},resetButtonIcon:{paddingTop:6}}}))(G)),$=function(e){Object(d.a)(a,e);var t=Object(f.a)(a);function a(e){var i;Object(h.a)(this,a),(i=t.call(this,e)).onReceiveMessage=function(e){if(e&&"chartReady"!==e.data)try{var t=JSON.parse(e.data);i.chartData?i.chartData.setConfig(t):i.createChartData(t)}catch(o){return console.log("Cannot parse "+e.data)}};var s=i.createTheme(),r=w.a.parseQuery(window.location.search),c=w.a.parseQuery((window.location.hash||"").replace(/^#/,""));i.state={connected:!1,seriesData:null,actualValues:null,noLoader:r.noLoader||c.noLoader||!1,theme:s,themeName:i.getThemeName(s),themeType:i.getThemeType(s),noBackground:r.noBG||c.noBG||!1},i.inEdit="1"===r.edit||1===r.edit||!0===r.edit||"true"===r.edit||"1"===c.edit||1===c.edit||!0===c.edit||"true"===c.edit,i.divRef=n.a.createRef(),i.progressRef=n.a.createRef(),i.progressShown=!0;var l={en:o(869),de:o(870),ru:o(871),pt:o(872),nl:o(873),fr:o(874),it:o(875),es:o(876),pl:o(877),"zh-cn":o(878)},u={en:o(879),de:o(880),ru:o(881),pt:o(882),nl:o(883),fr:o(884),it:o(885),es:o(886),pl:o(887),"zh-cn":o(888)};Object.keys(l).forEach((function(e){return l[e]=Object.assign(l[e],u[e])})),C.a.setTranslations(l);try{i.isIFrame=window.self!==window.top}catch(d){i.isIFrame=!0}return i.socket=new T.a({name:window.adapterName,onProgress:function(e){e===I.PROGRESS.CONNECTING?i.state.seriesData?(i.divRef.current&&(i.divRef.current.style.opacity=.5),i.progressRef.current&&(i.progressRef.current.style.display="block")):i.setState({connected:!1}):(I.PROGRESS.READY,i.setState({connected:!0}),i.restoreAfterReconnection())},onReady:function(e,t){C.a.setLanguage(i.socket.systemLang),i.socket.getSystemConfig().then((function(e){var t,o;if(i.systemLang=(null===e||void 0===e||null===(t=e.common)||void 0===t?void 0:t.language)||"en",i.isFloatComma=(null===e||void 0===e||null===(o=e.common)||void 0===o?void 0:o.isFloatComma)||!1,i.inEdit){if(window.addEventListener("message",i.onReceiveMessage),window.self!==window.parent)try{window.parent.postMessage("chartReady")}catch(d){console.warn("Cannot send ready event to parent window"),console.error(d)}}else i.createChartData()})).catch((function(e){e===I.ERRORS.NOT_CONNECTED?i.setState({connected:!1}):i.showError(C.a.t(e))}))},onError:function(e){console.error(e),i.showError(e)}}),i}return Object(u.a)(a,[{key:"restoreAfterReconnection",value:function(){this.divRef.current&&(this.divRef.current.style.opacity=1),this.progressRef.current&&!this.progressShown&&(this.progressRef.current.style.display="none"),this.state.seriesData&&!this.state.seriesData.find((function(e){return e.length}))&&this.chartData.setNewRange()}},{key:"createChartData",value:function(e){var t=this;this.chartData=new L(this.socket,e),this.chartData.onError((function(e){e===I.ERRORS.NOT_CONNECTED?(t.divRef.current&&(t.divRef.current.style.opacity=.5),t.progressRef.current&&(t.progressRef.current.style.display="block")):t.showError(C.a.t(e))})),this.chartData.onReading((function(e){return t.showProgress(e)})),this.chartData.onUpdate((function(e,o){var a={connected:!0,dataLoaded:!0};e&&(a.seriesData=e),o&&(a.actualValues=o),t.setState(a,(function(){return t.showProgress(!1)}))}))}},{key:"showProgress",value:function(e){this.progressShown=e,this.progressRef.current&&(this.progressRef.current.style.display=e?"block":"none")}},{key:"componentWillUnmount",value:function(){this.inEdit&&window.removeEventListener("message",this.onReceiveMessage,!1),this.chartData&&this.chartData.destroy()}},{key:"createTheme",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return E()(w.a.getThemeName(e))}},{key:"getThemeName",value:function(e){return e.name}},{key:"getThemeType",value:function(e){return e.palette.type}},{key:"showError",value:function(e){this.setState({errorText:e})}},{key:"renderError",value:function(){var e=this;return this.state.errorText?n.a.createElement(O.a,{classes:{},text:this.state.errorText,onClose:function(){return e.setState({errorText:""})}}):null}},{key:"componentDidUpdate",value:function(e,t,o){!this.progressShown&&this.progressRef.current&&"none"!==this.progressRef.current.style.display&&(this.progressRef.current.style.display="none")}},{key:"render",value:function(){var e=this;if(!this.state.connected||!this.state.seriesData)return this.state.noLoader?null:n.a.createElement(r.a,{theme:this.state.theme},n.a.createElement(k.a,{theme:this.state.themeType}));var t=this.chartData.getConfig(),o=y()(JSON.stringify((t&&t.l&&t.l.map((function(e){return e.id}))||[]).sort())).toString();return this.state.seriesData&&t.debug&&console.log("seriesData: "+JSON.stringify(this.state.seriesData)),n.a.createElement(r.a,{theme:this.state.theme},n.a.createElement("div",{ref:this.divRef,className:this.props.classes.root,style:{width:t.width,height:t.height,background:t.noBackground?void 0:this.state.theme.palette.background.default,color:this.state.theme.palette.text.primary}},n.a.createElement(b.a,{ref:this.progressRef,style:{display:"block"},className:this.props.classes.progress}),n.a.createElement(q,{key:o,socket:this.socket,t:C.a.t,noAnimation:this.state.noLoader,data:this.state.seriesData,actualValues:this.state.actualValues,config:t,lang:C.a.getLanguage(),themeType:this.state.themeType,onRangeChange:function(t){return e.chartData.setNewRange(t)}}),this.renderError()))}}]),a}(a.Component),Q=Object(m.a)()(Object(g.a)((function(e){return{root:{width:"100%",height:"100%",position:"relative"},progress:{position:"absolute",top:0,left:0,right:0}}}))(Object(p.a)($)));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var K=o(250);window.adapterName="echarts-show";var ee=w.a.getThemeName();console.log("iobroker."+window.adapterName+"@"+K.a+' using theme "'+ee+'"'),"localhost:3000"!==window.location.host&&c.a({dsn:"https://cf39325071144219aa91bb3510addcdf@sentry.iobroker.net/95",release:"iobroker."+window.adapterName+"@"+K.a,integrations:[new l.a]}),function e(){return s.a.render(n.a.createElement(r.a,{theme:E()(ee)},n.a.createElement(Q,{onThemeChange:function(t){ee=t,e()}})),document.getElementById("root"))}(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[425,1,2]]]);
//# sourceMappingURL=main.617f0492.chunk.js.map